<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="de"><head><title>JUKEBOX Taktikspiel</title>

<meta content="Hans Jeske" name="author">
<meta content="Jukebox Spiel" name="description">
<style>

<!-- Vs. 0.13: 4.2.2019 sauberes Spielfeld; Spieler zieht OK, Überschriften OK für alle Browser ; noch keine
<!--           Computerzüge; keine Logikprüfung auf Spieler
<!-- Vs. 0.14: erste simple Computerlogik freie/belegbare Felder
<!-- Vs. 0.15: Computercheck auf Legbarkeit von Covern (eingeschr. nur auf Zeile 1)
<!-- Vs. 0.16: 8.2.2019 Computer zieht und Vorrat füllt sich richtig auf; noch keinerlei Logik,
<!--           auch keine Plausiprüngen. Ausnahme: Computer setzt nur auf zulässige Felder, aber COVER-Typ
<!--           wird nicht gegengeprüft - Spieler kann auch (noch) frei platzieren
<!-- Vs. 0.50  10.2.2019 spielbare Vs ohne Bug; Computer zieht auf freie, zulässige Felder, beachtet Regeln
<!--           Feldauswahl rein nach dem Zufallsprinzip - Spielerverhalten wie gehabt
<!-- Vs. 0.51: 12.2.2019 Bugfixing ; YesNoTab Init., Cover Computer nachziehen wenn keine Anlegemöglichkeit
<!--           Routine zur Ermittlung des Siegers; wertet Diagonalen aus
<!-- Vs. 0.52  mit Link-Buttons Neues Spiel, Joker ziehen etc; COVER des Computers zT verdeckt (unfertig)
<!-- Vs. 0.60  auch Spieler beachtet Regeln; Bugfixing; Computer zieht Joker nach - Verdecktes Spiel geht
<!-- Vs. 0.70  3.3.2019 erstmals Computer mit Strategie; Option: 3 Cover oder 3 Cover + 1 Joker
<!--           StarsOn45 Startpos. variiert; Jokerverhältnis geändert: 10 ScanPlay, 6 normale
<!-- Vs. 0.71  Endanzeige Gewonnen/Verloren; anlegeopti(): Randfelder Mitte bewertet
<!-- Vs. 0.72  Läuft nicht auf ANDROID Tablet: HTML rel.Pfad IMG-Ornder geändert; +alle Images jetzt nur einmal laden
<!--           Prüfung auf Spielende: jetzt auch nach dem Computerzug
<!-- Vs. 0.73  Joker Funktion Scan&Play für Spieler implementiert; Computer: Jokersperre aus Diagonalen (Spielbeginn)
<!--           Spielbeginn jetzt variabel: Computer oder Spieler; Texte/Fkt.-Tasten: zentriert und verkürzt;
<!--           [zu lange Texte führten auf Tablets zu Problemen in der Tabellendarstellung - partiell grössere Spalten]
<!-- Vs. 0.80  Computerzug: Meldung über Aussetzen; Computer-Routine optim.: Setzen nach Zufall (beschleunigt)
<!--           Endeerkennung vervollständigt
<!-- Vs. 0.81  Computerzug: Strategieoptimierung lange Diagonalen auf verloren/gewonnen prüfen; JOKER setzen reduziert
<!-- Vs. 0.82  Optimierungen: Bewertungssystem geändert der Felder in YesNoPref; jetzt 1-8; COVER hochwertiger als JOKER
<!--           reine JOKER Felder in YesNoTab als "J" gekennzeichnet
<!--           JOKER im Spielevorrart COMPUTER jetzt immer am Ende (wird dadurch auch nicht vorschnell gewählt)
<!-- Vs. 0.90  Optimierungen: HilfeFunktion eingebaut; letztes COVER das der Computer gesetzt hat blinkt
<!--           Horizontales Scrollen unterbunden; in h2 jetzt width: 100% statt 1100px;
<!--           Achtung: async wird vom IE nicht unterstützt; dehalb manuelles STOPBLINK
<!-- Vs. 0.91  WEB-basierte Version (gehostet auf Github); Hilfedatei jetzt im INTERNET gespeichert, nicht mehr lokal
<!--           der Joker "img/Spiel_§§.png" muß umbenannt werden in Spiel_JO (§§ als Filename nicht zulässig)
<!--           Files im Ordner IMG alle  auf 320*320 Pixel verkleinert (kürzere Ladezeiten); Blinken optimiert: wird
<!--           jetzt auch inaktiv beim Klick in den Handvorrat (nächster Zug)
<!-- Vs. 0.92  IE unterstützt kein GitHub Preview. Hilfedatei wird nicht angezeigt, daher Browsertest integriert. Bei 
<!--           IE 11 oder kleiner wird lokale Hilfedatei angezeigt. Test auf diese Datei (file not found) nicht implmentierbar
<!--           [ ginge nur für IMAGES in JAVAscript ]
<!-- Vs. 1.00  Neue Spielfunktion: wenn eine 5er Diagonale gewonnen wurde erhalten Spieler/Computer ein STARS45 Cover. Wenn es  
<!--           gesetzt wird dann werden nach dem Zufallsprinzip 5-10 COVER entfernt (grüne/gelbe/rote). Blaue bleiben erhalten
<!--           Pro Spiel erhalten Spieler/Computer diese Möglichkeit nur einmal
<!-- Vs. 1.01  Neue Spielfunktion Vs 1.0: jetzt über LEVEL ein und ausschalten; kein Aussetzen wenn noch Joker auf der Hand  
<!-- Vs. 1.02  Hilfeseite: mit CLOSE Button, Spiel: Sprung ans HTML Seitenende beim Start
<!-- Vs. 1.50  unterschiedliche COVER jetzt wählbar aus Sätzen; BUTTONs für Spieloptionen zusammengelegt  
<!--           Spieloption LEVEL: wenn der Computer ein STARS-on-45 COVER erspielt wird das Ergebnisfeld blau gefärbt (Signal) 
<!-- Vs. 1.51  CoverAuswahl: autom. Erkennung des localhost und FIREFOX Browser            
<!--
<!-- folgende Definition bezieht sich auf TAG h1
<!--    sieht redundant/widersprüchlich aus; aber sonst keine große H1 Überschrift im IE möglich
<!--    noch optimieren: Farben / Rahmen von H2, ... aber sensibel; Tabellenaufbau schnell zerstört; IMG wichtig
<!--    Darstellung IE und Firefox immer abweichend !! Script "user strict" : verschärfte Javascript Syntaxprüfung   
<!-- -->
h1 {
color:#FF9F00; /* Farbe orange */
font-size:20pt; /* Größe 20pt */
font-family:arial, "lucida console", sans-serif; /* Schriftart */
}
h2 {
font-size:10pt; /* Größe 10pt */
}
</style></head>
<body style="color: yellow; background-color: black;" alink="#000099" link="#000099" vlink="#990099">
<section>
<a name="top">&nbsp;</a>
</section>
<div id="rand">
<h1 id="kopf"><img>JUKEBOX = Let the good times roll</h1>
<h2 id="pos"><img style="border: 0px solid ; width: 100%; height: 40px;" src="" alt="..... von Hans Jeske Vs.1.51 Anlegen nur waagerecht/senkrecht passend - ausser 'Scan&Play JOKER'  [ Klick, kein Drag&amp;Drop ]"></h2>
</div>
<div style="width: 40%;">
<table align="left" border="5" cellpadding="0" cellspacing="3" width="75">
<tbody>
<tr>
<!-- ohne width=100 kann die erste Zeile nicht mit Covern belegt werden; warum ?! -->
<td width="100"><div id="1"><a href="javascript:gamecontrol(1)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td width="100"><div id="2"><a href="javascript:gamecontrol(2)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td width="100"><div id="3"><a href="javascript:gamecontrol(3)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td width="100"><div id="4"><a href="javascript:gamecontrol(4)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td width="100"><div id="5"><a href="javascript:gamecontrol(5)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
</tr>
<tr>
<td><div id="6"><a href="javascript:gamecontrol(6)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="7"><a href="javascript:gamecontrol(7)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="8"><a href="javascript:gamecontrol(8)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="9"><a href="javascript:gamecontrol(9)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="10"><a href="javascript:gamecontrol(10)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
</tr>
<tr>
<td><div id="11"><a href="javascript:gamecontrol(11)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="12"><a href="javascript:gamecontrol(12)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="13"><a href="javascript:gamecontrol(13)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="14"><a href="javascript:gamecontrol(14)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="15"><a href="javascript:gamecontrol(15)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
</tr>
<tr>
<td><div id="16"><a href="javascript:gamecontrol(16)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="17"><a href="javascript:gamecontrol(17)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="18"><a href="javascript:gamecontrol(18)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="19"><a href="javascript:gamecontrol(19)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="20"><a href="javascript:gamecontrol(20)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
</tr>
<tr>
<td><div id="21"><a href="javascript:gamecontrol(21)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="22"><a href="javascript:gamecontrol(22)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="23"><a href="javascript:gamecontrol(23)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="24"><a href="javascript:gamecontrol(24)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
<td><div id="25"><a href="javascript:gamecontrol(25)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></div></td>
</tr>
<tr style="color: black;">
<td style="background-color: rgb(204, 255, 255); text-align: center;" colspan="5" rowspan="1">** Spielfeld ** Spielfeld
** Spielfeld ** </td>
</tr><tr>
<td rowspan="1" colspan="5" style="background-color: black;"><span style="color: black;">X</span></td></tr>
<tr>
<td style="background-color: white; color: rgb(0, 0, 153); text-align: center;"><a href="javascript:NeuesSpiel(01)">NeuSpiel</a></td>
<td style="background-color: white; color: rgb(0, 0, 153); text-align: center;"><a href="javascript:OnlineHilfe(01)">Hilfe</a></td>
<td style="background-color: white; color: rgb(0, 0, 153); text-align: center;"><div id="jok"><a href="javascript:SpielJoker(01)">+Joker</a></td>
<td style="background-color: white; color: rgb(0, 0, 153); text-align: center;"><div id="mul"><a href="javascript:Multi45(01)">Multi</a></div></td>
<td style="background-color: white; color: rgb(0, 0, 153); text-align: center;"><div id="lev"><a href="javascript:Level(01)">Level</a></div></td>
</tr>
</tbody>
</table>
</div>
<div style="float: right; width: 20%;">
<table style="width: 75px; text-align: left; margin-left: auto; margin-right: 0px;" border="5" cellpadding="0" cellspacing="3">
<tbody>
<tr>
<td><a href="javascript:gamecontrol(26)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
<td><a href="javascript:gamecontrol(27)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
</tr>
<tr>
<td><a href="javascript:gamecontrol(28)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
<td><a href="javascript:gamecontrol(29)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
</tr>
<tr>
<td><a href="javascript:gamecontrol(30)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
<td><a href="javascript:gamecontrol(31)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
</tr>
<tr>
<td><a href="javascript:gamecontrol(32)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
<td><a href="javascript:gamecontrol(33)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
</tr>
<tr>
<td><a href="javascript:gamecontrol(34)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
<td><a href="javascript:gamecontrol(35)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
</tr>
<tr style="color: black;">
<td style="background-color: rgb(204, 153, 51); text-align: center;" colspan="2" rowspan="1">** Computer **</td>
</tr><tr><td style="text-align: center;" colspan="2" rowspan="1" id="CCounter">000</td></tr>
<tr>
<td style="background-color: white; color: rgb(0, 0, 153); text-align: center;"><a href="javascript:OffenZu(01)">Offen/Zu</a></td>
<td style="background-color: white; color: rgb(0, 0, 153); text-align: center;"><div id="bli"><a href="javascript:BlinkAnAus(01)">Blink</a></div></td>

</tr>
</tbody>
</table>
</div>
<div style="float: right; width: 20%;">
<table style="width: 75px; text-align: left; margin-left: auto; margin-right: 0px;" border="5" cellpadding="0" cellspacing="3">
<tbody>
<tr>
<td><a href="javascript:gamecontrol(36)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
<td><a href="javascript:gamecontrol(37)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
</tr>
<tr>
<td><a href="javascript:gamecontrol(38)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
<td><a href="javascript:gamecontrol(39)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
</tr>
<tr>
<td><a href="javascript:gamecontrol(40)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
<td><a href="javascript:gamecontrol(41)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
</tr>
<tr>
<td><a href="javascript:gamecontrol(42)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
<td><a href="javascript:gamecontrol(43)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
</tr>
<tr>
<td><a href="javascript:gamecontrol(44)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
<td><a href="javascript:gamecontrol(45)"><img src="img/RockOla3.png" alt="" border="0" height="75" width="75"></a></td>
</tr>
<tr style="color: black;">
<td style="background-color: rgb(0, 136, 0); text-align: center;" onclick="" colspan="2" rowspan="1">** Spieler **</td>
</tr><tr><td style="text-align: center;" colspan="2" rowspan="1" id="SCounter">000</td></tr>
<tr>
<td style="background-color: white; color: rgb(0, 0, 153); text-align: center;"><a href="javascript:JokerZieh(01)">SetzAus</a></td>
<td style="background-color: white; color: rgb(0, 0, 153); text-align: center;"><a href="javascript:CoverAuswahl(01)">Cover</a></td></tr>
</tbody>
</table>
</div>
<br>

<script>
alert("Spielbeginn ...");
"use strict"; // Javascript Norm-Code
 
// da Anzeigedarstellung des Browsers unbekannt ist (zB ZOOM-Faktor) immer nach Start ans Ende = zum Spielfeld springen 
// zuerst wird mit Start-Alert der Seitenanfang eingeblendet, dann Sprung ans Ende (schön zu sehen bei kleinem Fenster)
function Seitenende() {
  document.getElementById("lev").scrollIntoView(true);
}
window.onload=function(){
Seitenende();
}

p = 0; // von Variable beim Zug des Spielers (aus Handvorrat)
y = 0; // Klickposition Spieler: Spielfeld und Vorrat (erstmalig)
zug = false; // true: Computer darf ziehen, sonst ist Spieler dran
runde = 0; // Computerspielrunde, Spielbeginn = 1
cswitch = false; // wenn wahr kann hat Spieler ein COVER zum legen gewählt (1. Schritt)
bswitch = false; // Blinken erwünscht/abstellen des letzten Computer-Covers
mswitch = false; // Multi45er: falls true spielen mit mehreren Star-On-45
jswitch = false; // Joker: falls true wird mit je einem Joker gespielt
SOffenZu = false; // true: Computer-Handvorrat wird offen gespielt
SCover45G = false; // Spieler:  COVER45 erhalten und ausgespielt falls true
SCover45Y = false; // Computer: COVER45 erhalten und ausgespielt falls true
SCover45Y_trigger = false; // Computer: braucht trigger um COVER45 auf der Hand später spielen zu können
SDiagG = false; // Spieler: eine oder zwei 5er Diagonalen gewonnen wenn wahr -einmal pro Spiel-
SDiagY = false; // Computer: ein oder zwei 5er Diagonalen gewonnen wenn wahr -eonmal pro spiel-
SLevel = false; // Spiel um STARS-on-45 COVER
YesNo = false; // Cover anlegbar ? Parameter zwischen div. Funktionen - TRUE mind. ein Feld gefunden
SiegY = 0;
SiegG = 0; // Zaehlvariablen. Siegpunkte Diagonalen
HighRow = 0; // Computerzug: opt. Feld Zeile
HighCol = 0; // Computerzug: opt. Feld Spalte
HighScore = 0; // Computerzug: Feld mit höchster Bewertung (aus func() anlegeopti)
ZuffRow = 0; // Computerzug: zufällig Feld Zeile
ZuffCol = 0; // Computerzug: zufällig Feld Spalte
Doc45 = 0; // StarsOn45 Position Cover (PNG Grafik) für doc.image
Row45 = 0; // StarsOn45 Start-Zeile
Col45 = 0; // StarsOn45 Start-Spalte
ZFreiFeld = 0; // Computerzug: Anzahl der Optionen (möglicher freier Felder)
zPrefN = 0; // in Anlageoptimierung für Computer: Diagonalen auswerten ob Gewinnposition Diagonale Joker+STARS45
zPrefYC = 0; // in Anlageoptimierung für Computer: Diagonalen auswerten ob Gewinnposition Diagonale Cover
zPrefGC = 0; // in Anlageoptimierung für Computer: Diagonalen auswerten ob Verlustposition Diagonale Cover

i=0;
j=0;
k=0;
z=0; // Laufvar.

var CPos = 0;  // für Blinken an/aus .. die Position des letzten Cpmputer Covers (1-25)
var t = 0;     // Event String SetInterval (Start/Stop Blinken)

// um die Spielfeld-Tabelle TCF  wird eine virtuelle Tabelle VTCF gebaut die
// jeweils oben/unten eine Zeile mehr hat und links/rechts eine Spalte mehr hat
// die Randfelder werden als "Frei" markiert; dadurch erheblicher einfacher Prüfalgorithmus

var VTCF_2D = [];
for (var row = 1; row <= 7; row++) {
   var VTCF_1D = [];
   for (var col = 1; col <= 7; col++) {
      VTCF_1D [col] = ("/");
      // Default: frei
   }
   VTCF_2D[row] = VTCF_1D;
}

//  ---------------------------------------

// ----Grafiken nur einmal von der Harddisk laden -------------------------------

// Cookie auslesen (gesetzt in CoverAuswahl - neues HTML Formular)
if(document.cookie){ 
   var a; var b;
   a = document.cookie;
   // alert("Cookie ist angekommen " + a);
   b = a.substr(9,1);
   // alert(b);
}
   
if (b==2) {
   img_Tamla_Y = "img/Tamla_Y_akt.png";
   img_Rock_Y = "img/Rock_Y_akt.png";
   img_Pop_Y = "img/Pop_Y_akt.png";
   img_Beat_Y = "img/Beat_Y_akt.png";
   img_Tamla_G = "img/Tamla_G_akt.png";
   img_Rock_G = "img/Rock_G_akt.png";
   img_Pop_G = "img/Pop_G_akt.png";
   img_Beat_G = "img/Beat_G_akt.png";
   img_Spiel = "img/Spiel_JO_akt.png";
   img_Spiel_SP = "img/Spiel_SP_akt.png";
   img_Stars45 = "img/Stars45_akt.png";
   }
      
if (b==3) {
   img_Tamla_Y = "img/HipHop_Y.png";
   img_Rock_Y = "img/Rap_Y.png";
   img_Pop_Y = "img/Singer_Y.png";
   img_Beat_Y = "img/Metall_Y.png";
   img_Tamla_G = "img/HipHop_G.png";
   img_Rock_G = "img/Rap_G.png";
   img_Pop_G = "img/Singer_G.png";
   img_Beat_G = "img/Metall_G.png";
   img_Spiel = "img/Spiel_JO_akt.png";
   img_Spiel_SP = "img/Spiel_SP_akt.png";
   img_Stars45 = "img/Stars45_akt.png";
   }
   
if (b==4) {   
   img_Tamla_Y = "img/HipHop_old_Y.png";
   img_Rock_Y = "img/Rap_old_Y.png";
   img_Pop_Y = "img/Singer_old_Y.png";
   img_Beat_Y = "img/Metall_old_Y.png";
   img_Tamla_G = "img/HipHop_old_G.png";
   img_Rock_G = "img/Rap_old_G.png";
   img_Pop_G = "img/Singer_old_G.png";
   img_Beat_G = "img/Metall_old_G.png";
   img_Spiel = "img/Spiel_JO_akt.png";
   img_Spiel_SP = "img/Spiel_SP_akt.png";
   img_Stars45 = "img/Stars45_akt.png";
   }
  
// Auswahl 1 und undefiniert führt zum gleichen Ergebnis  
if ((b!=2) && (b!=3) && (b!=4)) {
   img_Tamla_Y = "img/Tamla_Y.png";
   img_Rock_Y = "img/Rock_Y.png";
   img_Pop_Y = "img/Pop_Y.png";
   img_Beat_Y = "img/Beat_Y.png";
   img_Tamla_G = "img/Tamla_G.png";
   img_Rock_G = "img/Rock_G.png";
   img_Pop_G = "img/Pop_G.png";
   img_Beat_G = "img/Beat_G.png";
   img_Spiel = "img/Spiel_JO.png";
   img_Spiel_SP = "img/Spiel_SP.png";
   img_Stars45 = "img/Stars45.png";
   }

img_RockOla3 = "img/RockOla3.png";

// Cookie löschen damit es nicht endlos identisch ist
// wahlweise auskommentieren .... damit das Default-COVER nicht bei jedem neuen Spiel wieder gesetzt wird 
// document.cookie = "CoverTyp=;" + " expires=Thu, 01-Jan-70 00:00:01 GMT;";

// ----------TC = Tabellen Cover -----------------------------
// Tabelle TCS: Stock Cover Total je Spieler, Joker und StartOn45
var TCSY = [];
var TCSG = [];
var TCSR = [];
TCSB = [];
for (var a=0 ; a<=7 ; a++ )
{
   TCSY[a] = "R";
   TCSY[a+8]="T";
   TCSY[a+16]="B";
   TCSY[a+24]="P";
   // YELLOW 32 Cover
   TCSG[a] = "R";
   TCSG[a+8]="T";
   TCSG[a+16]="B";
   TCSG[a+24]="P";
   // GREEN 32 Cover
}

//  ---------------------------------------

// ---------------------------------------
for (var a=0 ; a<=5 ; a++ ) // RED 6 Cover Spiel mir das Lied vom Tod einfach (2*2 gibts vorab)
{
   TCSR[a] = "§§";
}

//  ---------------------------------------

// ---------------------------------------
for (var a=6 ; a<=15 ; a++ ) // RED 10 Cover Spiel mir das Lied vom Tod Scan&Play
{
   TCSR[a] = "SP";
}

//  ---------------------------------------

// ---------------------------------------
for (var a=0 ; a<=4 ; a++ ) // BLUE 5 Cover StarsOn45
{
   TCSB[a] = "45";
}

//  ---------------------------------------

// ---------------------------------------
// jeweils Mischen
shuffleTCS(TCSY);
shuffleTCS(TCSG);
shuffleTCS(TCSR);

// Tabelle TCV: Vorrat gezogen auf der Hand für Spieler (Green)/Computer(Yellow)
// verbrauchte Cover/unbelegte Felder werden auf "/" gesetzt
var TCVY = [];
var TCVG = [];
for (var a=1; a<=3; a++)
{
   TCVY[a] = TCSY[a];
   TCSY[a]="/";
   TCVG[a] = TCSG[a];
   TCSG[a]="/";
}

//  ---------------------------------------

for (var a=4; a<=10; a++)
{
   TCVY[a] = "/";
   TCVG[a] = "/";
}

//  ---------------------------------------

// Tabelle 3 Dim. TCF - Spielfeld 5x5, Achtung: Visuelle TAB document.images.src ist 1-dim. von 1-25
var TCF_3D = [];
for (var ele = 1; ele <= 3; ele++) {
   var TCF_2D = [];
   for (var row = 1; row <= 5; row++) {
      var TCF_1D = [];
      for (var col = 1; col <= 5; col++) {
         TCF_1D [col] = ("/");
      }
      TCF_2D[row] = TCF_1D;
   }
   TCF_3D[ele] = TCF_2D;
}

//  ---------------------------------------

// Tabelle 2 Dim. YesNoTab: bei Computer-Zug: alle mögl. belegbaren Felder
var YesNoTab_2D = [];
for (var row = 1; row <= 5; row++) {
   var YesNoTab_1D = [];
   for (var col = 1; col <= 5; col++) {
      YesNoTab_1D [col] = ("#");
      // Default: nicht anlegbar
   }
   YesNoTab_2D[row] = YesNoTab_1D;
}

//  ---------------------------------------

// Tabelle 2 Dim. YesNoPref: bei Computer-Zug: Felder mit der höchsten Prefenz
var YesNoPref_2D = [];
for (var row = 1; row <= 5; row++) {
   var YesNoPref_1D = [];
   for (var col = 1; col <= 5; col++) {
      YesNoPref_1D [col] =  0;
      // Default: nicht anlegbar
   }
   YesNoPref_2D[row] = YesNoPref_1D;
}

//  ---------------------------------------

//  ---------------------------------------
// Setzen StarsOn45 zufällig - doc.images immer + 1 links nach rechts
zufallszahl_rc();

// Row45 = 2;  mal zu Testzwecken (dann zufallszahl_rc deakt.
// Col45 = 2;

TCF_3D[1][Row45][Col45] = "45";
// Joker
TCF_3D[2][Row45][Col45] = "";
// Leer
TCF_3D[3][Row45][Col45] = "";
// Leer
Doc45 = (Row45-1)*5 + Col45 + 1;
document.images[Doc45].src = img_Stars45;

//

z = zufallszahl(2);
// Zufallszahl 0 oder 1 generieren - Spielbeginn
if (z == 0) {
   zug = true;
   // Computer beginnt - false ist default (sh oben)
   runde = runde + 1;
   computer();
   zug = false;
   alert("Computer hat begonnen");
}

//  ---------------------------------------
//  ---------------------------------------

displayTCVG();
//  Handvorrat Spieler aufdecken/anzeigen

displayTCVY(SOffenZu);
// Handvorrat Computer aufdecken/anzeigen :verdeckt beginnen


// ##################### Spielbeginn #################################

//  JUKEBOX: zentrale Spielsteuerung; Aufruf durch Mausklick oder Touch
function gamecontrol(y)
{

   if (!zug) {
      if (!cswitch) {         
         pplayer(y);
         // Spieler: der VON Zug
         return;
      }
      else
      pplayer(y);
      // Spieler: der NACH Zug
      cswitch = false;
      if (spielende()!=true) {
         // Spielende sowohl nach Spieler- oder Computerzug möglich
         if (zug) {
            runde = runde + 1;
            computer();
            zug = false;
         }
      }
      ;

      siegercalc();
      // Ergebnisauswertung
      if ((SiegY > 0) || (SiegG > 0)) {
         // Anzeige Spielstand nur sobald erste geschl. Diagonalen
         if (document.getElementById("CCounter")) {
            document.getElementById("CCounter").innerHTML = SiegY;
            document.getElementById("CCounter").style.textAlign = "center";
         }
         if (document.getElementById("SCounter")) {
            document.getElementById("SCounter").innerHTML = SiegG;
            document.getElementById("SCounter").style.textAlign = "center";
         }
      }
      ;
      // falls 5er Diagonale(n) gewonnen
      vergebenSTARS45();
      
      if (spielende()==true) {
         if (SiegG > SiegY) {
            alert("Gewonnen mit " + SiegG + " : " + SiegY)
         }
         ;
         if (SiegG < SiegY) {
            alert("Verloren mit " + SiegG + " : " + SiegY)
         }
         ;
         if (SiegG == SiegY) {
            alert("Unentschieden " + SiegG + " : " + SiegY)
         }
         ;
      }
      ;
   }
}

//  ---------------------------------------

//  Hauptprogramm Spieler ---- //
function pplayer(y)
{
   // Klick : y=erstmal wohin geklickt?
   // Klick : p=später immer die Quelle [y -> p ] sh. unten; 2 Züge

   zug = false;
   // Plausiprüfung: Bereich des Computers; als Zugquelle verboten
   if (y >= 26) {
      if (y <= 35) {
         cswitch=false;
         return;
      }
   }

   //  ---------------------------------------

   ;
   // Plausiprüfung: zweiter Klick (Nach) muss im Spielfeld sein
   // falls nicht alles zurück auf Anfang

   if (cswitch) {
      if ((y!=0) && (y>25)) {
         cswitch = false;
         y=0;
         p=0;
         return;
      }
   }
   ;

   //  ---------------------------------------

   ;
   // Plausiprüfung: erster Zug vom Spielfeld nicht erlaubt, nur dorthin (CSwitch sonst gesetzt)
   if (y >= 1) {
      if (y <= 25) {
         if (!cswitch)
         {
            stopblink(CPos); // Klick aufs Spielfeld stoppt Blinken des Computer Covers 
            return;
         }
      }
   }
   ;

   // Cover beim Spieler (Vorrat) anklicken; nur einmal pro Zug
   if (y >= 36) {
      if (y <=45) {
         if (TCVG[y-35] == "/") // in leeres Feld geklickt
         {
            y= 0;
            cswitch = false;
            // evtl gesetzt
            return;
         }
         else if (!cswitch) {
            // gültiger VON-Zug aus Handvorrat
            cswitch = true;
            p = y;
            y = 0;
            if (bswitch) { stopblink(CPos) }; // Vorsorglich; Funktion könnte aktiv sein
            return;
         }
      }
   }

   //  ---------------------------------------
    
   ;
   anlegepruef_player(y); 
   // gewähltes COVER anlegbar ?
   if (YesNo) {
      anlegezug_player(y);
      // alle Voraussetzungen OK - gültiger 2.ter Zug NACH
      YesNo = false;
      zug = true;
      // weiter mit Computer
   }
}
// - Ende Hauptprogramm- Spieler----------------------------------------------------------- //

//  Handvorrat Spieler anzeigen 
function displayTCVG()
{
   // immer bedenken : Array - Tabs starten mit NULL, also ( - 1) korr.
   // ab hier Computer (rechts ! ); wenn "/" passiert nichts
   z=27;
   for (var a=1; a<=10; a++)
   {
      // Belegung mit bildern - Spieler Vorratsfeld
      if (TCVG[a] == "P") document.images[z+10].src = img_Pop_G;
      if (TCVG[a] == "B") document.images[z+10].src = img_Beat_G;
      if (TCVG[a] == "T") document.images[z+10].src = img_Tamla_G;
      if (TCVG[a] == "R") document.images[z+10].src = img_Rock_G;
      if (TCVG[a] == "§§") document.images[z+10].src = img_Spiel;
      if (TCVG[a] == "SP") document.images[z+10].src = img_Spiel_SP;
      z=z+1;
   }

   //  ---------------------------------------

}

//  Handvorrat COVER des Computers anzeigen (ggf verdeckt)
function displayTCVY(SOffenZu)
{
   // immer bedenken : Array - Tabs starten mit NULL, also ( - 1) korr.
   // ab hier Computer (rechts ! ); wenn "/" passiert nichts

   z=27;
   for (var a=1; a<=10; a++) {
      if (SOffenZu) {
         // wenn wahr = Offenes Spiel
         // Belegung mit Bildern - Computer-Vorratsfeld

         if (TCVY[a] == "P") document.images[z].src  = img_Pop_Y;
         if (TCVY[a] == "B") document.images[z].src  = img_Beat_Y;
         if (TCVY[a] == "T") document.images[z].src  = img_Tamla_Y;
         if (TCVY[a] == "R") document.images[z].src  = img_Rock_Y;
         if (TCVY[a] == "§§") document.images[z].src = img_Spiel;
         if (TCVY[a] == "SP") document.images[z].src = img_Spiel_SP;
         if (TCVY[a] == "45") document.images[z].src = img_Stars45;
         z=z+1;
      }
      else {
         document.images[z].src = img_RockOla3;
         z=z+1;
      }
   }
}



//  Mischalgorithmus für beliebige Tabellen
function shuffleTCS(array) {
   for (var i = array.length - 1; i > 0; i--) {
      var j = Math.floor(Math.random() * (i + 1));
      var temp = array[i];
      array[i] = array[j];
      array[j] = temp;
   }
}


//  Zufallszahl ermitteln (immer zwischen 0 und (Parameter-1)
function zufallszahl(max) {
   return Math.floor(Math.random() * Math.floor(max));
}

//  Zufallszahl bestimmen Row / Column (nur STARS45)
function zufallszahl_rc()
{
   // Zeile/Spalte für StarsOn45-Start
   Row45=0;
   Col45=0;
   do
   {
      Row45 = zufallszahl(6);
      // Zufallszahl zwischen 0-5 generieren
   }
   while (Row45==0);
   // bei NULL Loop
   do
   {
      Col45 = zufallszahl(6);
   }
   while (Col45==0);
   // bei NULL Loop
}

//  Hauptprogramm Computer ---- //
function computer()
{
   var i;
   var j;
   var k;
   var row;
   var col;
   ZFreiFeld = 0;
   YesNo = false;
   

   // jetzt "innere" Tabelle füllen
   for (row = 2; row <= 6; row++) {
      for (col = 2; col <= 6; col++) {
         VTCF_2D[row][col] = TCF_3D[1][row-1][col-1]
      }
   }

   //  ---------------------------------------

   // YesNoTab vor nächstem Zug wieder leeren/löschen
   for (i=1; i<=5; i++) {
      for (j=1; j<=5; j++) {
         YesNoTab_2D[i][j] = "#";
         //Vorbeleg.: nicht möglich
         YesNoPref_2D[i][j] = 0;
         //Vorbeleg.: geringste Priorität
      }
   }

   //  ---------------------------------------

   // Anlegecheck pro Einzelfeld ueber komplettes Spielfeld gegen Vorrat (Computer)
   for (row=1; row<=5; row++) {
      for (col=1; col<=5; col++) {
         for (k=1; k<=10; k++) {
            // Vorrat durchsuchen
            anlegecheck(TCF_3D[1][row][col], row, col, TCVY[k]);
            // machbar?
            if (YesNo) {
               YesNo = false;
               ZFreiFeld = ZFreiFeld + 1;
               break;
               // sobald aus dem Vorrat ein COVER passt abbrechen
            }
            // nächstes COVER aus Vorrat
            else {
            }
            ;
         }
      }
   }

   
   //  ---------------------------------------
   if (ZFreiFeld == 0) {
      // kein Zug möglich; kein passendes Cover; Joker nachziehen
      TCSR_Nachziehen("C");
      // Aufruf aus Computer
      return;
   }

   // vor Anlegeoptimierung prüfen ... STARS45 auf der Hand und Situation angebracht auszuspielen ?

   if (SCover45Y_trigger) {         
      if ((runde >= 9) && ((SiegG-SiegY) > 4)) {
         SCover45Y_trigger = false;
         alert("Computer spielt STARS-on-45");
         // Spielmodus LEVEL: wenn Computer STARS45 gespielt Counterfeld wieder zurücksetzen
         document.getElementById("CCounter").style.backgroundColor = "black";
         zufallszahl_rc(); // ermitteln einer beliebigen Pos.: Row/Col 
         // Freifeldsuche
         do { zufallszahl_rc() }  
         while (TCF_3D[1][Row45][Col45] != "/");            
         // Cover45 aus Handvorrat Computer entfernen &  nachziehen
         for (k=1; k <=10; k++) {
           if (TCVY[k]=="45") {
              TCFDrop(k, Row45,Col45);
              TCVY_Nachziehen(k);
              break;
           }      
       }
       // Cover auf dem spielfeld entfernen
       spielzugSTARS45();
       return;       
       }
       if ((runde >= 10) && ((SiegG-SiegY) > 1)) {
         SCover45Y_trigger = false;
         alert("Computer spielt STARS-on-45");
         // Spielmodus LEVEL: wenn Computer STARS45 gespielt Counterfeld wieder zurücksetzen
         document.getElementById("CCounter").style.backgroundColor = "black";
         zufallszahl_rc(); // ermitteln einer beliebigen Pos.: Row/Col 
         // Freifeldsuche
         do { zufallszahl_rc() }  
         while (TCF_3D[1][Row45][Col45] != "/");            
         // Cover45 aus Handvorrat Computer entfernen &  nachziehen
         for (k=1; k <=10; k++) {
           if (TCVY[k]=="45") {
              TCFDrop(k, Row45,Col45);
              TCVY_Nachziehen(k);
              break;
           }      
       }
       // Cover auf dem spielfeld entfernen
       spielzugSTARS45();
       return;       
       }
   }   

   // Anlegezug-Optimierung HighScore
   // später:  Wechselspiel -> optim. Feld in Abhängigkeit vom Vorrat & Gegner blockieren!!
   // bedenken: mehr als ein COVER kann hor./vert. passen ! Aussetzen nicht möglich

   anlegeopti();

   if (HighScore > 0) {
      row = HighRow;
      col = HighCol;
      anlegezug(row, col);
      YesNoTab_2D[row][col] = "#";
      //belegt/verbraucht
   }
   else {
      anlegepos_zufall();
      // per Zufall ziehen: row/col bestimmen (!)
      row = ZuffRow;
      col = ZuffCol;
      anlegezug(row, col);
      YesNoTab_2D[row][col] = "#";
      //belegt/verbraucht
   }

}

//  Anlegen möglich ? gewähltes COVER gegen Spielfeld-Zelle für Spieler & Computer
function anlegecheck(TCFZelle, row, col, TCover)
{
   // Achtung: diese Funktion wird
   // a) pro Spielfeld aufgerufen, also Einzelprüfung wenn Computer am Zug
   //    genaugenommen: Max. für 5*5=25 Felder mal bei <= 10 Vorrats-Ccovern des Computers, also max 250mal
   // b) gezielt einmal aufgerufen wenn Spieler am Zug (für das geklickte Zielfeld)
   //
   // Besonderheit: TCover Stars-on-45 wird nicht geprüft... soll nicht im Normalspiel vom Computer gesetzt werden
   // nur weil er auf ein freies Feld passen würde (wie ein SP-Joker)

   var TCFZelle;
   var TCover;
   var row;
   var col;
   var SCover;       SCover = false;
   var JokerSperre;  JokerSperre = false;
   var DiagonalFeld; DiagonalFeld = false;

   if (TCover == "/") // leeres Feld aus Vorrat
   {
      YesNo = false;
      return;
   }

   //  ---------------------------------------

   // Prüfung: benachbarte Felder alle leer ? dann geht es nicht
   // Displacement für äussere Tabelle setzen

   row = row + 1;
   col = col + 1;

   // Zielfeld belegt ?
   if (VTCF_2D[row][col] != "/")   {
      YesNo= false;
      return;
   }

   //  ---------------------------------------

   ;
   // Nachbarfelder Check oben/unten/links/rechts
   if (VTCF_2D[row-1][col] != "/")   {
      SCover=true
   }

   //  ---------------------------------------

   ;
   if (VTCF_2D[row][col-1] != "/")   {
      SCover=true
   }

   //  ---------------------------------------

   ;
   if (VTCF_2D[row][col+1] != "/")   {
      SCover=true
   }

   //  ---------------------------------------

   ;
   if (VTCF_2D[row+1][col] != "/") {
      SCover=true
   }

   //  ---------------------------------------

   ;
   // wenn SCover=true dann mindestens ein benachbartes Feld belegt
   // Zug damit grundsaetzlich zulaessig -> Pruefung Anlegeregeln
   if (!SCover) {
      YesNo = false;
      return;
   }

   row = row -1;
   col = col -1;
   // für echte Spielfeld-Tabelle wieder zurückändern

   var temp;
   // 1. zeile
   if ( row ==1) {
      if (col > 1) {

         //Check links

         temp = TCF_3D[1][1][col-1];
         if (temp == "45") {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

         // egal; J & 45er gehen immer
         if (temp == "J") {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

         // P, R, T, B paarig; - Farbe egal
         if (temp == "C") {
            if (TCF_3D[3][1][col-1] == TCover) {
               YesNoTab_2D [row][col] = "+";
               YesNo = true;
               return;
            }
         }

         //  ---------------------------------------

      }

      //  ---------------------------------------

   }

   //  ---------------------------------------

   if ( row ==1) {
      if (col != 5) {

         temp = TCF_3D[1][1][col + 1];
         //Check rechts
         if (temp == "45") {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

         // egal; geht immer
         if (temp == "J") {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

         // P, R, T, B paarig; - Farbe egal
         if (temp == "C") {
            if (TCF_3D[3][1][col+1] == TCover) {
               YesNoTab_2D [row][col] = "+";
               YesNo = true;
               return;
            }
         }

         //  ---------------------------------------

      }

      //  ---------------------------------------

   }

   //  ---------------------------------------

   // 1. Zeile
   if ( row ==1) {

      temp = TCF_3D[1][2][col];
      //Check unten
      if (temp == "45") {
         YesNoTab_2D [row][col] = "+";
         YesNo = true;
         return;
      }

      //  ---------------------------------------

      // egal; J & C geht immer
      if (temp == "J") {
         YesNoTab_2D [row][col] = "+";
         YesNo = true;
         return;
      }

      //  ---------------------------------------

      // P, R, T, B paarig; - Farbe egal
      if (temp == "C") {
         if (TCF_3D[3][2][col] == TCover) {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

      }

      //  ---------------------------------------

   }

   //  ---------------------------------------

   var temp;
   // Letzte zeile
   if ( row ==5) {
      if (col > 1) {

         temp = TCF_3D[1][5][col-1];
         //Check links
         if (temp == "45") {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

         // egal; J & 45er gehen immer
         if (temp == "J") {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

         // P, R, T, B paarig; - Farbe egal
         if (temp == "C") {
            if (TCF_3D[3][5][col-1] == TCover) {
               YesNoTab_2D [row][col] = "+";
               YesNo = true;
               return;
            }
         }

         //  ---------------------------------------

      }

      //  ---------------------------------------

   }

   //  ---------------------------------------

   if ( row ==5) {
      if (col != 5) {

         temp = TCF_3D[1][5][col + 1];
         //Check rechts
         if (temp == "45") {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

         // egal; geht immer
         if (temp == "J") {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

         // P, R, T, B paarig; - Farbe egal
         if (temp == "C") {
            if (TCF_3D[3][5][col+1] == TCover) {
               YesNoTab_2D [row][col] = "+";
               YesNo = true;
               return;
            }
         }

         //  ---------------------------------------

      }

      //  ---------------------------------------

   }

   //  ---------------------------------------

   // Letzte Zeile
   if ( row ==5) {

      temp = TCF_3D[1][4][col];
      //Check oben
      if (temp == "45") {
         YesNoTab_2D [row][col] = "+";
         YesNo = true;
         return;
      }

      //  ---------------------------------------

      // egal; J & C geht immer
      if (temp == "J") {
         YesNoTab_2D [row][col] = "+";
         YesNo = true;
         return;
      }

      //  ---------------------------------------

      // P, R, T, B paarig; - Farbe egal
      if (temp == "C") {
         if (TCF_3D[3][4][col] == TCover) {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

      }

      //  ---------------------------------------

   }

   //  ---------------------------------------

   // Prüfung Tabellenmitte
   // Irgendwo in der Mitte; Zeile 1 und 5 schon geprüft (oben)
   // !!! (wird jetzt vorausgesetzt) - daher keine ROW-Abfrage !!!
   // Achtung:
   //     Row=1 oder Row=5 immer noch möglich; es muss ja keine
   //     Bedingung oben zutreffen - deshalb ausschliessen


   if ((row>1) && (row<5)) {
      if (col > 1) {

         var temp;
         temp = TCF_3D[1][row][col-1];
         //Check links
         if (temp == "45") {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

         // egal; J & 45er gehen immer
         if (temp == "J") {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

         // P, R, T, B paarig; - Farbe egal
         if (temp == "C") {
            if (TCF_3D[3][row][col-1] == TCover) {
               YesNoTab_2D [row][col] = "+";
               YesNo = true;
               return;
            }

            //  ---------------------------------------

         }

         //  ---------------------------------------

      }
      var temp;
      if (col !=5) {

         temp = TCF_3D[1][row][col+1];
         //Check rechts
         if (temp == "45") {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

         // egal; J & 45er gehen immer
         if (temp == "J") {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

         // P, R, T, B paarig; - Farbe egal
         if (temp == "C") {
            if (TCF_3D[3][row][col+1] == TCover) {
               YesNoTab_2D [row][col] = "+";
               YesNo = true;
               return;
            }

            //  ---------------------------------------

         }
      }

      var temp;
      temp = TCF_3D[1][row-1][col];
      //Check oben
      if (temp == "45") {
         YesNoTab_2D [row][col] = "+";
         YesNo = true;
         return;
      }

      //  ---------------------------------------

      // egal; J & 45er gehen immer
      if (temp == "J") {
         YesNoTab_2D [row][col] = "+";
         YesNo = true;
         return;
      }

      //  ---------------------------------------

      // P, R, T, B paarig; - Farbe egal
      if (temp == "C") {
         if (TCF_3D[3][row-1][col] == TCover) {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

      }

      var temp;
      temp = TCF_3D[1][row+1][col];
      //Check unten
      if (temp == "45") {
         YesNoTab_2D [row][col] = "+";
         YesNo = true;
         return;
      }

      //  ---------------------------------------

      // egal; J & 45er gehen immer
      if (temp == "J") {
         YesNoTab_2D [row][col] = "+";
         YesNo = true;
         return;
      }

      //  ---------------------------------------

      // P, R, T, B paarig; - Farbe egal
      if (temp == "C") {
         if (TCF_3D[3][row+1][col] == TCover) {
            YesNoTab_2D [row][col] = "+";
            YesNo = true;
            return;
         }

         //  ---------------------------------------

      }
   }


   // Prüfung auf Joker: soll auf ein Diagonalfeld gesetzt werden?
   if ((row==1)&&(col==1)) DiagonalFeld=true;
   if ((row==2)&&(col==2)) DiagonalFeld=true;
   if ((row==3)&&(col==3)) DiagonalFeld=true;
   if ((row==4)&&(col==4)) DiagonalFeld=true;
   if ((row==5)&&(col==5)) DiagonalFeld=true;
   if ((row==1)&&(col==5)) DiagonalFeld=true;
   if ((row==2)&&(col==4)) DiagonalFeld=true;
   if ((row==4)&&(col==2)) DiagonalFeld=true;
   if ((row==5)&&(col==1)) DiagonalFeld=true;
   // Sperre auch auf Mittelrandfelder
   if ((row==1)&&(col==3)) DiagonalFeld=true;
   if ((row==3)&&(col==1)) DiagonalFeld=true;
   if ((row==3)&&(col==5)) DiagonalFeld=true;
   if ((row==5)&&(col==3)) DiagonalFeld=true;

   if (TCover == "§§") {
      // kein Joker für Computer auf Diagonale zu Spielbeginn
      if (zug) {
         if (runde <= 3) {
            if (YesNoTab_2D [row][col] == "#") {
               if (DiagonalFeld) {
                  JokerSperre=true;
               }
            }
         }
      }
   }
   ;

   if ((TCover == "§§") && (!JokerSperre)) {
      // Joker - geht sonst immer
      YesNoTab_2D [row][col] = "J";
      YesNo = true;
      return;
   }
   ;

   if (TCover == "SP") {
      // kein Joker für Computer auf Diagonale zu Spielbeginn
      if (zug) {
         if (runde <= 3) {
            if (YesNoTab_2D [row][col] == "#") {
               if (DiagonalFeld) {
                  JokerSperre=true;
               }
               // Joker nicht verwenden
            }
         }
      }
   }
   ;

   if ((TCover == "SP") && (!JokerSperre)) {
      // Joker - geht sonst immer
      YesNoTab_2D [row][col] = "J";
      YesNo = true;
      return;
   }
   ;

   //  ---------------------------------------
}

//  Spieler & Computer: Anlegeprüfung für Scan&Play Joker 
function anlegecheck_SPJoker(TCFZelle, row, col, TCover)
{

   // Achtung: diese Funktion wird
   // a) gezielt einmal aufgerufen wenn Spieler am Zug (für das geklickte Zielfeld)
   // b) auch für den Computer nur einmal aufgerufen (Ergebnis von anlegeopti()-Auswertung

   var TCFZelle;
   var TCover;
   var row;
   var col;
   var SCover;
   SCover = false;

   if (TCover == "/") // leeres Feld aus Vorrat
   {
      YesNo = false;
      return;
   }

   //  ---------------------------------------

   // Prüfung: benachbarte Felder alle leer ? nicht nötig; hier zulässig
   // Displacement für äussere Tabelle setzen

   row = row + 1;
   col = col + 1;

   // Zielfeld belegt ?
   if (VTCF_2D[row][col] != "/")   {
      YesNo= false;
      return;
   }

   // Check Umgebung - Ränder berücksichtigen

   row = row -1;
   col = col -1;
   // für echte Spielfeld-Tabelle wieder zurückändern

   //  ---------------------------------------

   if (TCover == "SP") {
      // SP Joker - geht immer
      YesNoTab_2D [row][col] = "+";
      YesNo = true;
      return;
   }
}

//  Spieler & Computer: Anlegeprüfung für STARSon45 
function anlegecheck_STARS45(TCFZelle, row, col, TCover)
{

   // Achtung: diese Funktion wird
   // a) gezielt einmal aufgerufen wenn Spieler am Zug (für das geklickte Zielfeld)
   // b) auch für den Computer nur einmal aufgerufen (Ergebnis von anlegeopti()-Auswertung

   var TCFZelle;
   var TCover;
   var row;
   var col;
   var SCover;
   SCover = false;

   if (TCover == "/") // leeres Feld aus Vorrat
   {
      YesNo = false;
      return;
   }

   //  ---------------------------------------

   // Prüfung: benachbarte Felder alle leer ? nicht nötig; hier zulässig
   // Displacement für äussere Tabelle setzen

   row = row + 1;
   col = col + 1;

   // Zielfeld belegt ?
   if (VTCF_2D[row][col] != "/")   {
      YesNo= false;
      return;
   }

   // Check Umgebung - Ränder berücksichtigen

   row = row -1;
   col = col -1;
   // für echte Spielfeld-Tabelle wieder zurückändern

   //  ---------------------------------------

   if (TCover == "45") {
      // STARS-on-45 - geht immer
      YesNoTab_2D [row][col] = "+";
      YesNo = true;
      return;
   }
}

//  Anlegezug; Gültigkeit der Pos steht schon fest, COVER aus Handvorrat wird gesucht
function anlegezug(row, col)
{
   
   CPos = (row-1)*5 + col;
   // startblink();
   
   startblink(CPos);
   
   // an 45er-Feld anlegen: dann ist das Cover egal; hier wird erstmal immer No.1 genommen
   for (var i=1; i<=1; i++) {
      // Kunstgriff: FOR mit i=1; mit BREAK / RETURN  einfacher abzubrechen als IF/THEN/ELSE
      if (row != 1) {
         if (TCF_3D[1][row-1][col]=="45") {
            TCFDrop_45((row), col);
            TCVY_Nachziehen(1);
            return;
         }
      }
      if (col != 1) {
         if (TCF_3D[1][row][col-1]=="45") {
            TCFDrop_45(row, col);
            TCVY_Nachziehen(1);
            return;
         }
      }
      if (col != 5) {
         if (TCF_3D[1][row][col+1]=="45") {
            TCFDrop_45(row, col);
            TCVY_Nachziehen(1);
            return;
         }
      }
      if (row != 5) {
         if (TCF_3D[1][row+1][col]=="45") {
            TCFDrop_45((row), col);
            TCVY_Nachziehen(1);
            return;
         }
      }
   }

   //  ---------------------------------------

   // an Joker_Feld anlegen: dann ist das Cover egal; hier wird erstmal immer No.1 genommen

   for (var i=1; i<=1; i++) {
      // Kunstgriff: mit BREAK einfacher abzubrechen als IF/THEN/ELSEif
      if (row != 1) {
         if (TCF_3D[1][row-1][col]=="J") {
            TCFDrop_J((row), col);
            TCVY_Nachziehen(1);
            return;
         }
      }
      if (col != 1) {
         if (TCF_3D[1][row][col-1]=="J") {
            TCFDrop_J(row, (col));
            TCVY_Nachziehen(1);
            return;
         }
      }
      if (col != 5) {
         if (TCF_3D[1][row][col+1]=="J") {
            TCFDrop_J(row, (col));
            TCVY_Nachziehen(1);
            return;
         }
      }
      if (row != 5) {
         if (TCF_3D[1][row+1][col]=="J") {
            TCFDrop_J((row), col);
            TCVY_Nachziehen(1);
            return;
         }
      }
   }

   //  ---------------------------------------

   // COVER_Feld (P/B/T/R): passendes Cover suchen im Vorrat;
   for (var k=1; k <=10; k++) {
      if (TCVY[k] != "/") {
         // am Ende des Vorrats sind ggf Leerfelder ("/")
         if (row != 1) {
            if (TCVY[k]==TCF_3D[3][row-1][col]) {
               TCFDrop(k,  (row), col);
               TCVY_Nachziehen(k);
               return;
            }
         }
         if (col != 1) {
            if (TCVY[k]==TCF_3D[3][row][col-1]) {
               TCFDrop(k, row, (col));
               TCVY_Nachziehen(k);
               return;
            }
         }
         if (col != 5) {
            if (TCVY[k]==TCF_3D[3][row][col+1]) {
               TCFDrop(k, row, (col));
               TCVY_Nachziehen(k);
               return;
            }
         }
         if (row != 5) {
            if (TCVY[k]==TCF_3D[3][row+1][col]) {
               TCFDrop(k, (row), col);
               TCVY_Nachziehen(k);
               return;
            }
         }
      }
   }

   //  ---------------------------------------

   // COVER_Feld (P/B/T/R): kein passendes Cover im Vorrat; vielleicht JOKER? §§ oder SP
   for (k=1; k <=10; k++) {
      if (TCVY[k]=="§§") {
         TCFDrop(k,  (row), col);
         TCVY_Nachziehen(k);
         return;
      }
      if (TCVY[k]=="SP") {
         TCFDrop(k,  (row), col);
         TCVY_Nachziehen(k);
         return;
      }
   }

   //  ---------------------------------------
   
   // kein passendes COVER - 
   for (k=1; k <=10; k++) {
      if (TCVY[k]=="/") {
         // Vorratsende
         TCVY_Nachziehen(k);
         return;
      }
   }

   //  ---------------------------------------

}

//  Nachziehen Computer; es wird aufgerückt im Handvorrat
function TCVY_Nachziehen(k)
{
   //Aufrücken im Vorrat - Nachziehen normal (Computer)

   for (var b=k; b<=9; b++) {
      TCVY[b] = TCVY[b+1];
      if (TCVY[b+1] == "/") {
         k=(b);
         break;
      }
      if (SOffenZu) {
         if (TCVY[b] == "B") document.images[26+b].src  = img_Beat_Y;
         if (TCVY[b] == "P") document.images[26+b].src  = img_Pop_Y;
         if (TCVY[b] == "T") document.images[26+b].src  = img_Tamla_Y;
         if (TCVY[b] == "R") document.images[26+b].src  = img_Rock_Y;
         if (TCVY[b] == "§§") document.images[26+b].src = img_Spiel;
         if (TCVY[b] == "SP") document.images[26+b].src = img_Spiel_SP;
         if (TCVY[b] == "45") document.images[26+b].src = img_Stars45;
      }
      else {
         document.images[26+b].src = img_RockOla3;
      }
   }

   //  ---------------------------------------

   // Cover No. k gelegt; Nachziehen aus Stock; bei 45er und Joker - das erste Cover (k=0)
   for (var a=0; a<=31; a++)
   {
      if (TCSY[a] != "/")
      {
         TCVY[k] = TCSY[a];
         // Positionsgerecht füllen
         TCSY[a] = "/";
         // Entnahmepos. löschen
         if (SOffenZu) {
            if (TCVY[k] == "B") document.images[26+k].src = img_Beat_Y;
            if (TCVY[k] == "P") document.images[26+k].src = img_Pop_Y;
            if (TCVY[k] == "T") document.images[26+k].src = img_Tamla_Y;
            if (TCVY[k] == "R") document.images[26+k].src = img_Rock_Y;
            if (TCVY[k] == "§§") document.images[26+k].src = img_Spiel;
            if (TCVY[k] == "SP") document.images[26+k].src = img_Spiel_SP;
            if (TCVY[k] == "45") document.images[26+k].src = img_Stars45;
         }
         else {
            document.images[26+k].src = img_RockOla3;
         }
         break;
         // Exit FOR
      }
   }

   // Handvorrat sortieren, sodaß Joker am Ende liegen
   TCVY_Joker45_AnsEnde();
}

//  Nachziehen aus Joker-Vorrat für COMPUTER
function TCSR_Nachziehen(callby)
{
   // Nachziehen aus Joker-Vorrat
   // "C" aus function computer()   - Computer kann nicht legen; aussetzen
   // "S" aus function SpielJoker() - Computer erhält Joker zu Spielbeginn

   var callby;
   if (callby == "C") {
      alert("Computer setzt aus");
   }

   for (var i=1; i<=10; i++) {
      if (TCVY[i] == "/") {
         break;
      }
   }

   for (var a=0; a<=11; a++) {
      if (TCSR[a] != "/")   {
         // Leerstellen überspringen
         TCVY[i] = TCSR[a];
         // Positionsgerecht füllen
         TCSR[a] = "/";
         // Entnahmepos. löschen
         if (SOffenZu) {
            if (TCVY[i] == "§§") document.images[26+i].src = img_Spiel;
            if (TCVY[i] == "SP") document.images[26+i].src = img_Spiel_SP;
         }
         else {
            document.images[26+i].src = img_RockOla3;
         }
         break;
         // Exit FOR
      }
   }
   // Handvorrat sortieren, sodaß Joker/STARS45 am Ende liegen
   TCVY_Joker45_AnsEnde();
}

//  ---------------------------------------

//  ---------------------------------------
//  COVER Computer legen [Sp.-Pos. schon bestimmt] aus Vorrat(k) auf (row/col) incl Anzeige
function TCFDrop(k, row, col)
{
   var displace;
   displace = (row-1)*5 + col + 1;

   if (TCVY[k] == "P")
   {
      document.images[displace].src = img_Pop_Y;
      TCF_3D[1][row][col] = "C";
      // normales Cover
      TCF_3D[2][row][col] = "Y";
      // Spieler (Yellow)
      TCF_3D[3][row][col] = TCVY[k];
      // Stil (P/T/R/B)
   }

   //  ---------------------------------------

   if (TCVY[k] == "R")
   {
      document.images[displace].src = img_Rock_Y;
      TCF_3D[1][row][col] = "C";
      // normales Cover
      TCF_3D[2][row][col] = "Y";
      // Spieler (Yellow)
      TCF_3D[3][row][col] = TCVY[k];
      // Stil (P/T/R/B)
   }

   //  ---------------------------------------

   if (TCVY[k] == "B")
   {
      document.images[displace].src = img_Beat_Y;
      TCF_3D[1][row][col] = "C";
      // normales Cover
      TCF_3D[2][row][col] = "Y";
      // Spieler (Yellow)
      TCF_3D[3][row][col] = TCVY[k];
      // Stil (P/T/R/B)
   }

   //  ---------------------------------------

   if (TCVY[k] == "T")
   {
      document.images[displace].src = img_Tamla_Y;
      TCF_3D[1][row][col] = "C";
      // normales Cover
      TCF_3D[2][row][col] = "Y";
      // Spieler (Yellow)
      TCF_3D[3][row][col] = TCVY[k];
      // Stil (P/T/R/B)
   }

   //  ---------------------------------------
   if (TCVY[k] == "§§")
   {
      document.images[displace].src = img_Spiel;
      TCF_3D[1][row][col] = "J";
      // Joker
      TCF_3D[2][row][col] = "§§";
      TCF_3D[3][row][col] = "";
   }

   //  ---------------------------------------
   if (TCVY[k] == "SP")
   {
      document.images[displace].src = img_Spiel_SP;
      TCF_3D[1][row][col] = "J";
      // Joker
      TCF_3D[2][row][col] = "SP";
      TCF_3D[3][row][col] = "";
   }

   //  ---------------------------------------
   
   //  ---------------------------------------
   if (TCVY[k] == "45")
   {
      document.images[displace].src = img_Stars45;
      TCF_3D[1][row][col] = "45";
      // STARS45
      TCF_3D[2][row][col] = "";
      TCF_3D[3][row][col] = "";
   }
}

//  COVER Computer No 1 aus Handvorrat anlegen an STARS 45; geht immer; sonst wie TCFDrop 
function TCFDrop_45(row, col)
{
   var displace;
   displace = (row-1)*5 + col + 1;

   if (TCVY[1] == "P") {
      document.images[displace].src = img_Pop_Y;
      TCF_3D[1][row][col] = "C";
      TCF_3D[2][row][col] = "Y";
      TCF_3D[3][row][col] = TCVY[1];
   }

   //  ---------------------------------------

   if (TCVY[1] == "B") {
      document.images[displace].src = img_Beat_Y;
      TCF_3D[1][row][col] = "C";
      TCF_3D[2][row][col] = "Y";
      TCF_3D[3][row][col] = TCVY[1];
   }

   //  ---------------------------------------

   if (TCVY[1] == "R") {
      document.images[displace].src = img_Rock_Y;
      TCF_3D[1][row][col] = "C";
      TCF_3D[2][row][col] = "Y";
      TCF_3D[3][row][col] = TCVY[1];
   }

   //  ---------------------------------------

   if (TCVY[1] == "T") {
      document.images[displace].src = img_Tamla_Y;
      TCF_3D[1][row][col] = "C";
      TCF_3D[2][row][col] = "Y";
      TCF_3D[3][row][col] = TCVY[1];
   }

   //  ---------------------------------------

   if (TCVY[1] == "§§") {
      TCF_3D[1][row][col] = "J";
      TCF_3D[2][row][col] = "§§";
      TCF_3D[3][row][col] = "";
      document.images[displace].src = img_Spiel;
   }

   //  ---------------------------------------

   if (TCVY[1] == "SP") {
      TCF_3D[1][row][col] = "J";
      TCF_3D[2][row][col] = "SP";
      TCF_3D[3][row][col] = "";
      document.images[displace].src = img_Spiel_SP;
   }

   //  ---------------------------------------

}

//  ---------------------------------------

//  COVER Computer No 1 aus Handvorrat anlegen an Joker (§§/SP); geht immer; sonst wie TCFDrop
function TCFDrop_J(row, col)
{
   var displace;
   displace = (row-1)*5 + col + 1;
   if (TCVY[1] == "P") {
      document.images[displace].src = img_Pop_Y;
      TCF_3D[1][row][col] = "C";
      TCF_3D[2][row][col] = "Y";
      TCF_3D[3][row][col] = TCVY[1];
   }

   //  ---------------------------------------

   if (TCVY[1] == "B") {
      document.images[displace].src = img_Beat_Y;
      TCF_3D[1][row][col] = "C";
      TCF_3D[2][row][col] = "Y";
      TCF_3D[3][row][col] = TCVY[1];
   }

   //  ---------------------------------------

   if (TCVY[1] == "R") {
      document.images[displace].src = img_Rock_Y;
      TCF_3D[1][row][col] = "C";
      TCF_3D[2][row][col] = "Y";
      TCF_3D[3][row][col] = TCVY[1];
   }

   //  ---------------------------------------

   if (TCVY[1] == "T") {
      document.images[displace].src = img_Tamla_Y;
      TCF_3D[1][row][col] = "C";
      TCF_3D[2][row][col] = "Y";
      TCF_3D[3][row][col] = TCVY[1];
   }

   //  ---------------------------------------

   if (TCVY[1] == "§§") {
      TCF_3D[1][row][col] = "J";
      TCF_3D[2][row][col] = "§§";
      TCF_3D[3][row][col] = "";
      document.images[displace].src = img_Spiel;
   }

   //  ---------------------------------------

   if (TCVY[1] == "SP") {
      TCF_3D[1][row][col] = "J";
      TCF_3D[2][row][col] = "SP";
      TCF_3D[3][row][col] = "";
      document.images[displace].src = img_Spiel_SP;
   }

   //  ---------------------------------------

}

//  Spielende: keine leeren Felder mehr 
function spielende()
{
   for(i=1; i<=5; i++) {
      for (j=1; j<=5; j++) {
         if (TCF_3D[1][i][j] == "/")
         {
            return false;
         }
         // noch leere Spielfelder
      }
   }

   //  ---------------------------------------

   return true;
}

//  ---------------------------------------

//  Anlegeoptimierung: Feldwerte KI; Spielfeld beurteilen
function anlegeopti()
{
   HighRow = 0;
   HighCol = 0;
   HighScore = 0;

   // alert("Anlegeopti");
   // spielbare Felder am Rand (Ergebnis 1 und 3)
   for (i=1; i<=5; i++) {
      for (j=1; j<=5; j++) {
         if ((i=1) && (YesNoTab_2D[i][j] == "+")) YesNoPref_2D[i][j] = 3;
         // ganze erste Zeile
         if ((i=5) && (YesNoTab_2D[i][j] == "+")) YesNoPref_2D[i][j] = 3;
         // ganze letzte Zeile
         if ((i=1) && (YesNoTab_2D[i][j] == "J")) YesNoPref_2D[i][j] = 1;
         // ganze erste Zeile
         if ((i=5) && (YesNoTab_2D[i][j] == "J")) YesNoPref_2D[i][j] = 1;
         // ganze letzte Zeile
      }
   }
   for (i=1; i<=5; i++) {
      for (j=1; j<=5; j++) {
         if ((j=1) && (YesNoTab_2D[i][j] == "+")) YesNoPref_2D[i][j] = 3;
         // ganze erste Spalte
         if ((j=5) && (YesNoTab_2D[i][j] == "+")) YesNoPref_2D[i][j] = 3;
         // ganze letzte Spalte
         if ((j=1) && (YesNoTab_2D[i][j] == "J")) YesNoPref_2D[i][j] = 1;
         // ganze erste Spalte
         if ((j=5) && (YesNoTab_2D[i][j] == "J")) YesNoPref_2D[i][j] = 1;
         // ganze letzte Spalte

         // jedes Feld am Rand auf 1; falls kein JOKER-Anlegefeld dann 3
      }
   }
   // oder alle Felder nicht am Rand (Ergebnis 2 und 4)
   for (i=2; i<=4; i++) {
      for (j=2; j<=4; j++) {
         if (YesNoTab_2D[i][j] == "+")
         {
            YesNoPref_2D[i][j] = YesNoPref_2D[i][j] + 4;
            // jedes Feld nicht am Rand + 1
         }
         if (YesNoTab_2D[i][j] == "J")
         {
            YesNoPref_2D[i][j] = YesNoPref_2D[i][j] + 2;
            // jedes Feld nicht am Rand + 1
         }
      }
   }

   // alle Felder auf den Hauptdiagonalen  (Wert steigt dann auf 4, 5, usw bis 8)
   for (i=1; i<=5; i++) {
      for (j=1; j<=5; j++) {
         if ((YesNoTab_2D[i][j] == "+") || (YesNoTab_2D[i][j] == "J"))
         {
            if ((i==1)&&(j==1)) YesNoPref_2D[i][j] = YesNoPref_2D[i][j] + 3;
            if ((i==2)&&(j==2)) YesNoPref_2D[i][j] = YesNoPref_2D[i][j] + 3;
            if ((i==3)&&(j==3)) YesNoPref_2D[i][j] = YesNoPref_2D[i][j] + 3;
            // s.a. weiter unten
            if ((i==4)&&(j==4)) YesNoPref_2D[i][j] = YesNoPref_2D[i][j] + 3;
            if ((i==5)&&(j==5)) YesNoPref_2D[i][j] = YesNoPref_2D[i][j] + 3;
            if ((i==1)&&(j==5)) YesNoPref_2D[i][j] = YesNoPref_2D[i][j] + 3;
            if ((i==2)&&(j==4)) YesNoPref_2D[i][j] = YesNoPref_2D[i][j] + 3;
            if ((i==3)&&(j==3)) YesNoPref_2D[i][j] = YesNoPref_2D[i][j] + 1;
            // noch eins mehr für die Mitte
            if ((i==4)&&(j==2)) YesNoPref_2D[i][j] = YesNoPref_2D[i][j] + 3;
            if ((i==5)&&(j==1)) YesNoPref_2D[i][j] = YesNoPref_2D[i][j] + 3;

         }
      }
   }

   // die Mittelfelder am Rand höher bewerten (3er Doppeldiagonalen)
   if (YesNoTab_2D[1][3] == "+") YesNoPref_2D[1][3] = YesNoPref_2D[1][3] + 2;
   if (YesNoTab_2D[3][1] == "+") YesNoPref_2D[3][1] = YesNoPref_2D[3][1] + 2;
   if (YesNoTab_2D[3][5] == "+") YesNoPref_2D[3][5] = YesNoPref_2D[3][5] + 2;
   if (YesNoTab_2D[5][3] == "+") YesNoPref_2D[5][3] = YesNoPref_2D[5][3] + 2;
   if (YesNoTab_2D[1][3] == "J") YesNoPref_2D[1][3] = YesNoPref_2D[1][3] + 2;
   if (YesNoTab_2D[3][1] == "J") YesNoPref_2D[3][1] = YesNoPref_2D[3][1] + 2;
   if (YesNoTab_2D[3][5] == "J") YesNoPref_2D[3][5] = YesNoPref_2D[3][5] + 2;
   if (YesNoTab_2D[5][3] == "J") YesNoPref_2D[5][3] = YesNoPref_2D[5][3] + 2;

   // Check: schon grosse Diagonalen gewonnen/verloren  ? dann Preferenz verlagern
   if (runde >= 4) {
      // alert("Start Anlege-Optimierung");
      anlegeopti_diagonal();
   }


   // wenn optimales Feld gefunden Koordinaten bestimmen
   for (i=1; i<=5; i++) {
      for (j=1; j<=5; j++) {
         if (YesNoPref_2D[i][j] != 0)
         {
            if (YesNoPref_2D[i][j]>=HighScore)
            {
               HighRow = i;
               HighCol = j;
               HighScore = YesNoPref_2D[i][j];
            }
         }
      }
   }


}

//  ---------------------------------------

//  für Computer kein HighScore vorhanden - Zufallszug bestimmen ----
function anlegepos_zufall()
{
   var i;
   var j;
   var z;
   var row;
   var col;
   ZFreiFeld = 0;
   YesNo = false;

   // Zähler der max. möglichen, ziehbaren Felder
   for (row=1; row<=5; row++) {
      for (col=1; col<=5; col++)  {
         if (YesNoTab_2D[row][col] == "+") {
            ZFreiFeld = ZFreiFeld + 1;
         }
      }
   }

   // jetzt Feldnr per Zufallszahl bestimmen
   z = 0;
   do {
      z = zufallszahl(ZFreiFeld+1);
      // Funktion immer +1 (
   }
   while (z==0);

   // Feldnr in Zeile/Spalte umrechnen (links oben nach rechts unten)
   ZFreiFeld = 0;
   for (row=1; row<=5; row++) {
      for (col=1; col<=5; col++)  {
         if (YesNoTab_2D[row][col] == "+") {
            ZFreiFeld = ZFreiFeld + 1;
            if (ZFreiFeld == z) {
               ZuffRow = row;
               ZuffCol = col;
               return;
            }
         }
      }
   }
   // alte Routine: langsam auf Tablets gegen Spielende (viele SIM-Läufe)
   /* YesNo = false;
   do {
   do
   {
   row = zufallszahl(6); // Zufallszahl zwischen 0-5 generieren
   }
   while (row==0); // bei NULL Loop
   do
   {
   col = zufallszahl(6);
   }
   while (col==0); // bei NULL Loop
   if (YesNoTab_2D[row][col] == "+") YesNo = true;
   }
   while (!YesNo);
   YesNoTab_2D[row][col] = "#";  // Feld row/col gewählt; als belegt kennzeichnen
   ZuffRow = row;
   ZuffCol = col;
   // alert("Zufall: " + ZuffRow + " " + ZuffCol);
   */

}

//  für den Spieler: Prüfung ob Anlegen des gewählten COVERS möglich (Hauptmodul)
function anlegepruef_player(y)
{
   var i;
   var j;
   var row;
   var col;
   YesNo = false;


   // jetzt "innere" Tabelle füllen
   for (row = 2; row <= 6; row++) {
      for (col = 2; col <= 6; col++) {
         VTCF_2D[row][col] = TCF_3D[1][row-1][col-1]
      }
   }

   //  ---------------------------------------

   // YesNoTab vor nächstem Zug wieder leeren/löschen
   for (i=1; i<=5; i++) {
      for (j=1; j<=5; j++) {
         YesNoTab_2D[i][j] = "#";
         //Vorbeleg.: nicht möglich
      }
   }

   //  ---------------------------------------

   // Anlegecheck Cover gegen 4 Felder oben/unten/links/rechts gegen Auswahlpos.
   j=y-0.1;
   row = Math.floor(j/5) +1;
   // Abrunden auf INTEGER
   col = (y % 5);
   // Modulo-Funktion
   if (col == 0) col = 5;
   // Rest NULL, zB 10 bedeutet Zeile 2, Spalte 5
   if (TCVG[p-36+1] == "SP") {
      anlegecheck_SPJoker(TCF_3D[1][row][col], row, col, TCVG[p-36+1])
      return;
   }
   if (TCVG[p-36+1] == "45") {
      anlegecheck_STARS45(TCF_3D[1][row][col], row, col, TCVG[p-36+1])
      return;
   }
   // normaler Check
   anlegecheck(TCF_3D[1][row][col], row, col, TCVG[p-36+1])
   // YesNo wird zurückgegeben; True=Anlegecheck positiv
}

//  Anlegen des Spielers incl Visualisierung
function anlegezug_player(y)
{
   // document.image (Grafik) muss immer um +1 versetzt werden
   // ist nicht 2-dim; zählt von 1-25
   var displace;
   displace = y + 1;
   var k;
   k = TCVG[p-36+1];
   // Umrechnen 1-25 in 5*5-Matrix, zB 7 -> Zeile 2, Spalte 2
   var row;
   var col;
   var j;
   j = y - 0.01;
   // wg 5, 10, 15 usw
   row = Math.floor(j/5) + 1;
   // Abrunden auf INTEGER
   col = y  % 5;
   // Modulo-Funktion
   if (col == 0) col = 5;
   if (k == "P")
   {
      document.images[displace].src = img_Pop_G;
      TCF_3D[1][row][col] = "C";
      // normales Cover
      TCF_3D[2][row][col] = "G";
      // Spieler (Green)
      TCF_3D[3][row][col] = TCVG[p-36+1];
      // Stil (P/T/R/B)
      YesNoTab_2D[row][col] = "#";
      // Feld nicht mehr frei/möglich
      cswitch = false;
   }

   //  ---------------------------------------

   if (k == "R")
   {
      document.images[displace].src = img_Rock_G;
      TCF_3D[1][row][col] = "C";
      // normales Cover
      TCF_3D[2][row][col] = "G";
      // Spieler (Green)
      TCF_3D[3][row][col] = TCVG[p-36+1];
      // Stil (P/T/R/B)
      YesNoTab_2D[row][col] = "#";
      // Feld nicht mehr frei/möglich
      cswitch = false;
   }

   //  ---------------------------------------

   if (k == "B")
   {
      document.images[displace].src = img_Beat_G;
      TCF_3D[1][row][col] = "C";
      // normales Cover
      TCF_3D[2][row][col] = "G";
      // Spieler (Green)
      TCF_3D[3][row][col] = TCVG[p-36+1];
      // Stil (P/T/R/B)
      YesNoTab_2D[row][col] = "#";
      // Feld nicht mehr frei/möglich
      cswitch = false;
   }

   //  ---------------------------------------

   if (k == "T")
   {
      document.images[displace].src = img_Tamla_G;
      TCF_3D[1][row][col] = "C";
      // normales Cover
      TCF_3D[2][row][col] = "G";
      // Spieler (Green)
      TCF_3D[3][row][col] = TCVG[p-36+1];
      // Stil (P/T/R/B)
      YesNoTab_2D[row][col] = "#";
      // Feld nicht mehr frei/möglich
      cswitch = false;
   }

   //  ---------------------------------------

   if (k == "§§")
   {
      document.images[displace].src = img_Spiel;
      TCF_3D[1][row][col] = "J";
      // Joker
      TCF_3D[2][row][col] = "§§";
      // normal
      TCF_3D[3][row][col] = "";
      YesNoTab_2D[row][col] = "#";
      // Feld nicht mehr frei/möglich
      cswitch = false;
   }

   //  ---------------------------------------

   if (k == "SP")
   {
      document.images[displace].src = img_Spiel_SP;
      TCF_3D[1][row][col] = "J";
      // Joker
      TCF_3D[2][row][col] = "SP";
      // Scan&Play
      TCF_3D[3][row][col] = "";
      YesNoTab_2D[row][col] = "#";
      // Feld nicht mehr frei/möglich
      cswitch = false;
   }

   //  ---------------------------------------

   if (k == "45")
   {
      document.images[displace].src = img_Stars45;
      TCF_3D[1][row][col] = "45";
      // Joker
      TCF_3D[2][row][col] = "";
      // Scan&Play
      TCF_3D[3][row][col] = "";
      YesNoTab_2D[row][col] = "#";
      // Feld nicht mehr frei/möglich
      cswitch = false;
      // sonst werden immer nur COVER gesetzt; keine Aktion ausser Feldbelegung
      // Ausnahme: STARS45 ... COVER vom Spielfeld entfernen
      spielzugSTARS45();
   }

   //  ---------------------------------------

   // Cover gelegt; Nachziehen aus Stock
   for (var a=0; a<=31; a++)
   {
      if (TCSG[a] != "/")
      {
         TCVG[p-36+1] = TCSG[a];
         TCSG[a]="/";
         // Positionsgerecht füllen
         if (TCVG[p-36+1] == "B") document.images[p+1].src = img_Beat_G;
         if (TCVG[p-36+1] == "P") document.images[p+1].src = img_Pop_G;
         if (TCVG[p-36+1] == "T") document.images[p+1].src = img_Tamla_G;
         if (TCVG[p-36+1] == "R") document.images[p+1].src = img_Rock_G;
         if (TCVG[p-36+1] == "§§") document.images[p+1].src = img_Spiel;
         if (TCVG[p-36+1] == "SP") document.images[p+1].src = img_Spiel_SP;
         p = 0;
         y= 0;
         break;
         // Exit FOR
      }
   }

   //  ---------------------------------------

   return;
   // Zug komplett abgeschlossen incl Nachziehen Stock
}

//  Spielstand ermitteln (Final und Zwischendurch)
function siegercalc()
{
   var ZY;
   var ZG;
   var zfeld;
   var ZG4Total; var ZY4Total;

   // Auswerten 2 5er Diagonalen - nur Yellow/Green zählen

   ZY = 0;
   ZG = 0;
   zfeld = 0;
   SiegY = 0;
   SiegG = 0;
   // werden nicht kumuliert sondern nach jedem Zug
   // neu berechnet
   for (i=1; i<=5; i++) {
      if (TCF_3D[1][i][i] != "/") zfeld = zfeld + 1;
      if (TCF_3D[2][i][i] == "Y") ZY = ZY + 1;
      if (TCF_3D[2][i][i] == "G") ZG = ZG + 1;
   }

   //  ---------------------------------------

   if (zfeld == 5) {
      if (ZY > ZG) SiegY = SiegY + 5;
      if (ZY < ZG) SiegG = SiegG + 5;
   }
   
   // für Testzwecke
   //if (runde == 5) {
   // SCover45G = true; SDiagG = true;
   // SCover45Y = true; SDiagY = true;
   // SLevel = true;
   // }
      
   // neu ab Vs 1.00: Check ob lange Diag li. oben/re. unten gewonnen wurde
   // ZG > ZY ... mehr grüne als gelbe Cover usw.
   if (zfeld == 5) {
      if ((!SDiagY) && (ZY > ZG)) {
         SDiagY = true;
         SCover45Y = true;
         }
      if ((!SDiagG) && (ZG > ZY)) {
         SDiagG = true;
         SCover45G = true;
         }
    }     
    //  ---------------------------------------

   ZY = 0;
   ZG = 0;
   zfeld = 0;
   for (i=1; i<=5; i++) {
      j=6-i;
      if (TCF_3D[1][i][j] != "/") zfeld = zfeld + 1;
      if (TCF_3D[2][i][j] == "Y") ZY = ZY + 1;
      if (TCF_3D[2][i][j] == "G") ZG = ZG + 1;
   }

   //  ---------------------------------------

   if (zfeld == 5) {
      if (ZY > ZG) SiegY = SiegY + 5;
      if (ZY < ZG) SiegG = SiegG + 5;
   }
   
   // neu ab Vs 1.00: Check ob lange Diag re. oben/li. unten gewonnen wurde
   if (zfeld == 5) {
      if ((!SDiagY) && (ZY > ZG)) {
         SDiagY = true;
         SCover45Y = true;
         }
      if ((!SDiagG) && (ZG > ZY)) {
         SDiagG = true;
         SCover45G = true;
         }
    }   
   
   // Auswerten 4 Lange 4er Diagonalen - nur Yellow/Green zählen

   ZY = 0; ZY4Total = 0;
   ZG = 0; ZG4Total = 0;
   zfeld = 0;
   for (i=1; i<=4; i++) {
      if (TCF_3D[1][i][i+1] != "/") zfeld = zfeld + 1;
      if (TCF_3D[2][i][i+1] == "Y") ZY = ZY + 1;
      if (TCF_3D[2][i][i+1] == "G") ZG = ZG + 1;
   }

   //  ---------------------------------------

   if (zfeld == 4) {
      if (ZY > ZG) {SiegY = SiegY + 3; ZY4Total = ZY4Total + 1;};
      if (ZY < ZG) {SiegG = SiegG + 3; ZG4Total = ZG4Total + 1;};
   }

   //  ---------------------------------------

   ZY = 0;
   ZG = 0;
   zfeld = 0;
   for (i=1; i<=4; i++) {
      j=5-i;
      if (TCF_3D[1][i][j] != "/") zfeld = zfeld + 1;
      if (TCF_3D[2][i][j] == "Y") ZY = ZY + 1;
      if (TCF_3D[2][i][j] == "G") ZG = ZG + 1;
   }

   //  ---------------------------------------

   if (zfeld == 4) {
      if (ZY > ZG) {SiegY = SiegY + 3; ZY4Total = ZY4Total + 1;};
      if (ZY < ZG) {SiegG = SiegG + 3; ZG4Total = ZG4Total + 1;};
   }

   //  ---------------------------------------

   ZY = 0;
   ZG = 0;
   zfeld = 0;
   for (i=2; i<=5; i++) {
      if (TCF_3D[1][i][i-1] != "/") zfeld = zfeld + 1;
      if (TCF_3D[2][i][i-1] == "Y") ZY = ZY + 1;
      if (TCF_3D[2][i][i-1] == "G") ZG = ZG + 1;
   }

   //  ---------------------------------------

   if (zfeld == 4) {
      if (ZY > ZG) {SiegY = SiegY + 3; ZY4Total = ZY4Total + 1;};
      if (ZY < ZG) {SiegG = SiegG + 3; ZG4Total = ZG4Total + 1;};
   }

   //  ---------------------------------------

   ZY = 0;
   ZG = 0;
   zfeld = 0;
   for (i=2; i<=5; i++) {
      j=7-i;
      if (TCF_3D[1][i][j] != "/") zfeld = zfeld + 1;
      if (TCF_3D[2][i][j] == "Y") ZY = ZY + 1;
      if (TCF_3D[2][i][j] == "G") ZG = ZG + 1;
   }

   //  ---------------------------------------

   if (zfeld == 4) {
      if (ZY > ZG) {SiegY = SiegY + 3; ZY4Total = ZY4Total + 1;};
      if (ZY < ZG) {SiegG = SiegG + 3; ZG4Total = ZG4Total + 1;};
   }
   
   // neu ab Vs 1.00: Check ob min. 2 der 4er  Diagonalen gewonnen wurden
   if (ZY4Total >= 2){
      if (!SDiagY) {
         SDiagY = true;
         SCover45Y = true;
         }
   }
   if (ZG4Total >= 2){     
      if (!SDiagG) {
         SDiagG = true;
         SCover45G = true;
         }
   }   
   //  ---------------------------------------

   // Auswerten 4 Lange 3er Diagonalen - nur Yellow/Green zählen

   ZY = 0;
   ZG = 0;
   zfeld = 0;
   for (i=1; i<=3; i++) {
      if (TCF_3D[1][i][i+2] != "/") zfeld = zfeld + 1;
      if (TCF_3D[2][i][i+2] == "Y") ZY = ZY + 1;
      if (TCF_3D[2][i][i+2] == "G") ZG = ZG + 1;
   }

   //  ---------------------------------------

   if (zfeld == 3) {
      if (ZY > ZG) SiegY = SiegY + 2;
      if (ZY < ZG) SiegG = SiegG + 2;
   }

   //  ---------------------------------------

   ZY = 0;
   ZG = 0;
   zfeld = 0;
   for (i=1; i<=3; i++) {
      j=4-i;
      if (TCF_3D[1][i][j] != "/") zfeld = zfeld + 1;
      if (TCF_3D[2][i][j] == "Y") ZY = ZY + 1;
      if (TCF_3D[2][i][j] == "G") ZG = ZG + 1;
   }

   //  ---------------------------------------

   if (zfeld == 3) {
      if (ZY > ZG) SiegY = SiegY + 2;
      if (ZY < ZG) SiegG = SiegG + 2;
   }

   //  ---------------------------------------

   ZY = 0;
   ZG = 0;
   zfeld = 0;
   for (i=3; i<=5; i++) {
      if (TCF_3D[1][i][i-2] != "/") zfeld = zfeld + 1;
      if (TCF_3D[2][i][i-2] == "Y") ZY = ZY + 1;
      if (TCF_3D[2][i][i-2] == "G") ZG = ZG + 1;
   }

   //  ---------------------------------------

   if (zfeld == 3) {
      if (ZY > ZG) SiegY = SiegY + 2;
      if (ZY < ZG) SiegG = SiegG + 2;
   }

   //  ---------------------------------------

   ZY = 0;
   ZG = 0;
   zfeld = 0;
   for (i=3; i<=5; i++) {
      j=8-i;
      if (TCF_3D[1][i][j] != "/") zfeld = zfeld + 1;
      if (TCF_3D[2][i][j] == "Y") ZY = ZY + 1;
      if (TCF_3D[2][i][j] == "G") ZG = ZG + 1;
   }

   //  ---------------------------------------

   if (zfeld ==3) {
      if (ZY > ZG) SiegY = SiegY + 2;
      if (ZY < ZG) SiegG = SiegG + 2;
   }

   //  ---------------------------------------

   // Auswerten 4 kurze 2er Diagonalen - nur Yellow/Green zählen

   ZY = 0;
   ZG = 0;
   zfeld = 0;
   for (i=1; i<=2; i++) {
      if (TCF_3D[1][i][i+3] != "/") zfeld = zfeld + 1;
      if (TCF_3D[2][i][i+3] == "Y") ZY = ZY + 1;
      if (TCF_3D[2][i][i+3] == "G") ZG = ZG + 1;
   }

   //  ---------------------------------------

   if (zfeld == 2) {
      if (ZY > ZG) SiegY = SiegY + 1;
      if (ZY < ZG) SiegG = SiegG + 1;
   }

   //  ---------------------------------------

   ZY = 0;
   ZG = 0;
   zfeld = 0;
   for (i=1; i<=2; i++) {
      j=3-i;
      if (TCF_3D[1][i][j] != "/") zfeld = zfeld + 1;
      if (TCF_3D[2][i][j] == "Y") ZY = ZY + 1;
      if (TCF_3D[2][i][j] == "G") ZG = ZG + 1;
   }

   //  ---------------------------------------

   if (zfeld == 2) {
      if (ZY > ZG) SiegY = SiegY + 1;
      if (ZY < ZG) SiegG = SiegG + 1;
   }

   //  ---------------------------------------

   ZY = 0;
   ZG = 0;
   zfeld = 0;
   for (i=4; i<=5; i++) {
      if (TCF_3D[1][i][i-3] != "/") zfeld = zfeld + 1;
      if (TCF_3D[2][i][i-3] == "Y") ZY = ZY + 1;
      if (TCF_3D[2][i][i-3] == "G") ZG = ZG + 1;
   }

   //  ---------------------------------------

   if (zfeld == 2) {
      if (ZY > ZG) SiegY = SiegY + 1;
      if (ZY < ZG) SiegG = SiegG + 1;
   }

   //  ---------------------------------------

   ZY = 0;
   ZG = 0;
   zfeld = 0;
   for (i=4; i<=5; i++) {
      j=9-i;
      if (TCF_3D[1][i][j] != "/") zfeld = zfeld + 1;
      if (TCF_3D[2][i][j] == "Y") ZY = ZY + 1;
      if (TCF_3D[2][i][j] == "G") ZG = ZG + 1;
   }

   //  ---------------------------------------

   if (zfeld == 2) {
      if (ZY > ZG) SiegY = SiegY + 1;
      if (ZY < ZG) SiegG = SiegG + 1;
   }

   //  ---------------------------------------

}

//  Computer: 5er Diagonalen nur bespielen wenn noch nicht gewonnen/verloren
function anlegeopti_diagonal()
{
   // Prüfen: auf den 5er Hauptdiagonalen schon Majorität oder Minorität ? dann Preferenz reduzieren

   zPrefN = 0;
   zPrefYC = 0;
   zPrefGC = 0;


   // Links (d.h links oben nach rechts unten)
   for (i=1; i<=5; i++) {
      if (TCF_3D[1][i][i] == "C") {
         if (TCF_3D[2][i][i] == "Y") {
            zPrefYC = zPrefYC + 1;
         }
      }
      if (TCF_3D[1][i][i] == "C") {
         if (TCF_3D[2][i][i] == "G") {
            zPrefGC = zPrefGC + 1;
         }
      }
      if (TCF_3D[1][i][i] == "J") {
         zPrefN = zPrefN + 1;
      }
      if (TCF_3D[1][i][i] == "45") {
         zPrefN = zPrefN + 1;
      }
   }

   if (zPrefYC >=3){
      // alert("Anlege-Optimierung: Linke Diagonale schon gewonnen");
      for (i=1; i<=5; i++) {
         if (YesNoPref_2D[i][i] != 0) {
            YesNoPref_2D[i][i] =  1;
         }
      }
   }
   if (zPrefGC >=3){
      // alert("Anlege-Optimierung: Linke Diagonale schon verloren");
      for (i=1; i<=5; i++) {
         if (YesNoPref_2D[i][i] != 0) {
            YesNoPref_2D[i][i] =  1;
         }
      }
   }

   if ((zPrefYC == 2) && ((zPrefYC + zPrefN) >= 4)) {
      // alert("Anlege-Optimierung: Linke Diagonale Mix schon gewonnen");
      for (i=1; i<=5; i++) {
         if (YesNoPref_2D[i][i] != 0) {
            YesNoPref_2D[i][i] =  1;
         }
      }
   }
   if ((zPrefGC == 2) && ((zPrefGC + zPrefN) >= 4)) {
      // alert("Anlege-Optimierung: Linke Diagonale Mix schon verloren");
      for (i=1; i<=5; i++) {
         if (YesNoPref_2D[i][i] != 0) {
            YesNoPref_2D[i][i] =  1;
         }
      }
   }
   // alert("Links: " + " Y " + zPrefYC + " G " + zPrefGC + " Neutral " + zPrefN);

   zPrefN = 0;
   zPrefYC = 0;
   zPrefGC = 0;

   // das gleiche für Rechts (d.h. rechts oben nach links unten)
   j=5;
   for (i=1; i<=5; i++) {
      if (TCF_3D[1][i][j] == "C") {
         if (TCF_3D[2][i][j] == "Y") {
            zPrefYC = zPrefYC + 1;
         }
      }
      if (TCF_3D[1][i][j] == "C") {
         if (TCF_3D[2][i][j] == "G") {
            zPrefGC = zPrefGC + 1;
         }
      }
      if (TCF_3D[1][i][j] == "J") {
         zPrefN = zPrefN + 1;
      }
      if (TCF_3D[1][i][j] == "45") {
         zPrefN = zPrefN + 1;
      }
      j=j-1;
   }
   if (zPrefYC >= 3) {
      // alert("Anlege-Optimierung: Rechte Diagonale schon gewonnen");
      j=5;
      for (i=1; i<=5; i++) {
         if (YesNoPref_2D[i][j] != 0) {
            YesNoPref_2D[i][j] =  1;
         }
         j=j-1;
      }
   }
   if (zPrefGC >= 3) {
      // alert("Anlege-Optimierung: Rechte Diagonale schon verloren");
      j=5;
      for (i=1; i<=5; i++) {
         if (YesNoPref_2D[i][j] != 0) {
            YesNoPref_2D[i][j] =  1;
         }
         j=j-1;
      }
   }
   if ((zPrefYC == 2) && ((zPrefYC + zPrefN) >= 4)) {
      // alert("Anlege-Optimierung: Rechte Diagonale Mix schon gewonnen");
      j=5;
      for (i=1; i<=5; i++) {
         if (YesNoPref_2D[i][j] != 0) {
            YesNoPref_2D[i][j] =  1;
         }
         j=j-1;
      }
   }
   if ((zPrefGC == 2) && ((zPrefGC + zPrefN) >= 4)) {
      // alert("Anlege-Optimierung: Rechte Diagonale Mix schon verloren");
      j=5;
      for (i=1; i<=5; i++) {
         if (YesNoPref_2D[i][j] != 0) {
            YesNoPref_2D[i][j] =  1;
         }
         j=j-1;
      }
   }
   // alert("Rechts: " + " Y " + zPrefYC + " G " + zPrefGC + " Neutral " + zPrefN);
   zPrefY = 0;
   zPrefYC = 0;
   zPrefGC = 0;

   // noch nicht implementiert --
   return;

   /*
   Komplex: wann und wo Joker Scan&Play setzen
   a) auf Diagonalen  um diese zu gewinnen (Cover-Mehrheit)
   b) auf langen Diagonalen (4er, 5er)  um ein Unentschieden zu sichern
   c) um das Spiel zu verlagern (wann sinnvoll?)

   Bedenken:
   Diagonalen können CoverTyp/SpielerTyp-gemischt sein
   Lücken haben
   Lücken nicht nur am Ende prüfen
   Zusatzprüfung:
   - muß S&P gesetzt werden ? ist nicht auch ein normales Cover möglich?
   - ist die Diagonale ggf schon gewonnen (Überzahl), also S&P unnötig?

   */
}

//  ---------------------------------------

//  Button: Neues Spiel
function NeuesSpiel()
{
   location.reload();
   
}

//  ---------------------------------------

//  Button: Computer spielt offen/zu
function OffenZu()
{
   if (SOffenZu) {
      SOffenZu = false;
   }

   //  ---------------------------------------

   else {
      SOffenZu = true;
   }

   //  ---------------------------------------

   displayTCVY(SOffenZu);
}

//  ---------------------------------------

//  Button: Aussetzen - Spieler zieht Joker nach 
function JokerZieh()
{
   // Prüfung vorab: Aussetzen nur zulässig wenn kein Joker auf der Hand
   for (var i=1; i<=10; i++) {
        if ((TCVG[i] == "§§") || (TCVG[i] == "SP")) {
            alert("Aussetzen nicht möglich ! noch Joker auf der Hand");
            return;
        }    
   }

   TCSR_Nachziehenplayer();
   //  -  Joker genommen: gibt einen Computerzug Extra -------------------------------
   computerzugplus();
}

//  Spieler: Joker nachziehen
function TCSR_Nachziehenplayer()
{       
     
  loop: {
      // Joker auf die Hand (zusätzlich)
      for (var k=1; k<=10; k++) {
         if (TCVG[k] == "/") {
            // Position suchen
            for (var a=0; a<=11; a++)  {
               if (TCSR[a] != "/")    {
                  // Joker suchen
                  TCVG[k] = TCSR[a];
                  TCSR[a] ="/";
                  // verbraucht
                  if (TCVG[k] == "§§") document.images[36+k].src = img_Spiel;
                  if (TCVG[k] == "SP") document.images[36+k].src = img_Spiel_SP;
                  break loop;
                  // Exit 2*FOR;
               }
            }
         }
      }
   }
}

//  ---------------------------------------

//  ein zusätzlicher Computerzug (wenn Spieler Joker nimmt)
function computerzugplus()
{
   zug = true;
   computer();

   // wenn der Aufruf der Function computer() aus computerzugplus() kommt kann auch hier Spielende sein
   // Anm.: Aufruf dann nicht aus gamecontrol() - Spieler musste Joker nachziehen/passen

   if (spielende()==true) {
      siegercalc();
      // Ergebnisauswertung
      if (document.getElementById("CCounter")) {
         document.getElementById("CCounter").innerHTML = SiegY;
         document.getElementById("CCounter").style.textAlign = "center";
      }
      if (document.getElementById("SCounter")) {
         document.getElementById("SCounter").innerHTML = SiegG;
         document.getElementById("SCounter").style.textAlign = "center";
      }
      if (SiegG > SiegY) {
         alert("Gewonnen mit " + SiegG + " : " + SiegY)
      }
      ;
      if (SiegG < SiegY) {
         alert("Verloren mit " + SiegG + " : " + SiegY)
      }
      ;
      if (SiegG == SiegY) {
         alert("Unentschieden " + SiegG + " : " + SiegY)
      }
      ;
   }
   ;
   zug = false;
}

//  ---------------------------------------

//  Button: Spiel mit je einem Joker-COVER mehr
function SpielJoker()
{

    // max. 1 Joker pro Partei
    if ((!zug) && (runde <=1)) {         
      if (!jswitch) {         
           jswitch = true; 
           document.getElementById("jok").style.backgroundColor = "orange";     
           TCSR_Nachziehenplayer();
           TCSR_Nachziehen("S");
           // Aufruf aus function() SpielJoker
       }
    }       
}

//  ---------------------------------------

//  Computer: Joker/45 immer ans Ende des Handvorrats sortieren
function TCVY_Joker45_AnsEnde()
{
   var temp;
   var handkarten;
   // Computer: Handkarten zaehlen


   for (var i=10; i>=2; i--) {
      if (TCVY[i] != "/")
      {
         handkarten = i;
         break;
      }
   }
   // alert("X");
   for (var i=1; i<=(handkarten-1); i++) {
      if (TCVY[i] == "§§") {
         temp = TCVY[i];
         TCVY[i] = TCVY[i+1];
         TCVY[i+1] = temp;
         document.images[35].src = document.images[26+i].src;
         document.images[26+i].src = document.images[26+i+1].src;
         document.images[26+i+1].src = document.images[35].src;
         // hier nicht sauber; statt 34 andere Quelle
         document.images[35].src = document.images[34].src;
      }
   }
   for (var i=1; i<=(handkarten-1); i++) {
      if (TCVY[i] == "SP") {
         temp = TCVY[i];
         TCVY[i] = TCVY[i+1];
         TCVY[i+1] = temp;
         document.images[35].src = document.images[26+i].src;
         document.images[26+i].src = document.images[26+i+1].src;
         document.images[26+i+1].src = document.images[35].src;
         // hier nicht sauber; statt 34 andere Quelle
         document.images[35].src = document.images[34].src;
      }
   }
   for (var i=1; i<=(handkarten-1); i++) {
      if (TCVY[i] == "45") {
         temp = TCVY[i];
         TCVY[i] = TCVY[i+1];
         TCVY[i+1] = temp;
         document.images[35].src = document.images[26+i].src;
         document.images[26+i].src = document.images[26+i+1].src;
         document.images[26+i+1].src = document.images[35].src;
         // hier nicht sauber; statt 34 andere Quelle
         document.images[35].src = document.images[34].src;
      }
   }
}

//  ---------------------------------------

//  ---------------------------------------

//  Spieler nimmt Zug zurück (nicht realisiert)
function ZugZurueck()
{
   alert("Zurueck");
}

//  ---------------------------------------

//  Button: Computer Level/Schwierigkeitsgrad Spiel um STARS-on-45 COVER) - nur zu Spielbeginn
function Level()
{        
   if ((!zug) && (runde <=1)) { 
       if (SLevel)  {
           SLevel = false
           document.getElementById("lev").style.backgroundColor = "white";
           }
       else {
           SLevel = true
           document.getElementById("lev").style.backgroundColor = "orange";
           };    
    }
}            

//  Button: Anzeigen Online Hilfe und Spielregeln
function OnlineHilfe()
{
      
   //IE 11 Hilfe nur lokal
   browserIsIE = navigator.userAgent.toUpperCase().indexOf("TRIDENT/") != -1 
   if (browserIsIE) {
       var HilfeFenster = window.open("JUKEBOX_Hilfe.html", "Zweitfenster", "  width=1100,height=400,left=100,top=200,resizable=yes,scrollbars=yes");
      // Hilfe immer in den Vordergrund
      HilfeFenster.focus();
      return;
   }
    
   //IE <> 11 allgemein Hilfe nur lokal   
   browserIsIE = navigator.userAgent.toUpperCase().indexOf("MSIE") != -1;
   if (browserIsIE) {
       var HilfeFenster = window.open("JUKEBOX_Hilfe.html", "Zweitfenster", "  width=1100,height=400,left=100,top=200,resizable=yes,scrollbars=yes");
       // Hilfe immer in den Vordergrund
       HilfeFenster.focus();
       return;
   }
   
   //alle anderen Browser Hilfe via WEB (Github)
   var HilfeFenster = window.open("https://htmlpreview.github.io/?https://github.com/jukebox9/jeske/blob/master/JUKEBOX_Hilfe.html", "Zweitfenster", "width=1100,height=400,left=100,top=200,resizable=yes,scrollbars=yes");    
   // Hilfe immer in den Vordergrund
   HilfeFenster.focus();        
   
}
//  Button: Spieler kann zwischen verschiedenen COVER-Sätzen wählen
function CoverAuswahl()
{
   // ****************************************************************************************************************
   // Achtung: die Cookie-Funktion in CoverAuswahl geht nicht beim LocalHost (Ausser FIREFOX) ... wichtig fuers Testen
   // ****************************************************************************************************************   
   
   // file: (localhost) oder http: (server)
   var urlheader;
   urlheader = location.protocol;
   // alert(urlheader);
   
   //IE 11 CoverAuswahl nur lokal
   browserIsIE = navigator.userAgent.toUpperCase().indexOf("TRIDENT/") != -1 
   if (browserIsIE) {
      var CoverFenster = window.open("JUKEBOX_CoverAuswahl.html", "Zweitfenster", "  width=500,height=600,left=100,top=200,resizable=yes,scrollbars=yes"); 
      // Hilfe immer in den Vordergrund
      CoverFenster.focus();
      return;
   }
    
   //IE <> 11 CoverAuswahl nur lokal   
   browserIsIE = navigator.userAgent.toUpperCase().indexOf("MSIE") != -1;
   if (browserIsIE) {
       var CoverFenster = window.open("JUKEBOX_CoverAuswahl.html", "Zweitfenster", "  width=500,height=600,left=100,top=200,resizable=yes,scrollbars=yes");
       // Hilfe immer in den Vordergrund
       CoverFenster.focus();
       return;
   }      
   
    var i;
    var agent = navigator.userAgent.toUpperCase();
    i = agent.indexOf("FIREFOX",1);
    if(i!=(-1)) { 
       // nur für den lokalen Testbetrieb (localhost) mit FIREFOX gedacht
       if (urlheader=="file:") {
          var CoverFenster = window.open("JUKEBOX_CoverAuswahl.html", "Zweitfenster", "width=500,height=600,left=100,top=200,resizable=yes,scrollbars=yes");    
          // Hilfe immer in den Vordergrund
          CoverFenster.focus(); 
          return
       }
    }           
    
    // Alle anderen Browser CoverAuswahl via WEB (Github - MUSS) - dann muss aber das Spiel auch via Link auf dem Host gestartet werden 
    // sonst passiert einfach nichts
    if (urlheader=="https:") {
       var CoverFenster = window.open("https://htmlpreview.github.io/?https://github.com/jukebox9/jeske/blob/master/JUKEBOX_CoverAuswahl.html",
       "Zweitfenster", "width=500,height=600,left=100,top=200,resizable=yes,scrollbars=yes");    
       // Hilfe immer in den Vordergrund
       CoverFenster.focus();
       return;        
       }
}
  
//  vom Computer gesetztes COVER blinkt
function startblink(CPos) {
//
   var blink_speed = 500;
   var dummy = 0;

   // every 1000 == 1 second, adjust to suit
   
   if (!bswitch) {
       return;
       } 
      t = setInterval(function () {
      var ele = document.getElementById(CPos);
      ele.style.visibility = (ele.style.visibility == 'hidden' ? '' : 'hidden');
   }
   , blink_speed);
   
   // stopblink als  ASsync Funktion hier aktivieren 
   // ansonsten hält der INTERPRETER das Javascipt an; es blinkt erst garnicht
   
   // stopblink(CPos);
//
}
//  vom Computer gesetztes blinkendes COVER ausschalten 
function stopblink(CPos) {
    
   clearInterval(t);
   document.getElementById(CPos).style.visibility = "visible";
   
//   
}
//  Button: Blinken an und aus
function BlinkAnAus() {
//
    var ofs = 0;
    var el = document.getElementById('imp');
    
    // Button: auf orange gesetzt
    if (!bswitch) {
         document.getElementById("bli").style.backgroundColor = "orange";
         bswitch = true;
         }  
    else {    
         bswitch = false; 
         document.getElementById("bli").style.backgroundColor = "white";             
    }       
}

//  Button: mit mehreren STARS on 45 spielen
function Multi45() {
  
    // zum vorhandenen Stars45 Cover kommen noch ein oder 2 dazu (Zufall)
    if ((!zug) && (runde <=1)) {         
      if (!mswitch) {         
           mswitch = true; 
           document.getElementById("mul").style.backgroundColor = "orange";     
           z = zufallszahl(2);
        // z = Zufallszahl 0 oder 1 generieren - Spielbeginn
        z = z + 1;                 
        do
        {
           // Setzen StarsOn45 zufällig - doc.images immer + 1 links nach rechts
           zufallszahl_rc(); // für Row/Col 1-5
           // kann belegt sein (zB wenn Computer anfängt und erstes COVER gesetzt hat) 
           if (TCF_3D[1][Row45][Col45] == "/") { 
               // Stars-on-45
               TCF_3D[1][Row45][Col45] = "45";               
               TCF_3D[2][Row45][Col45] = "";               
               TCF_3D[3][Row45][Col45] = "";               
               Doc45 = (Row45-1)*5 + Col45 + 1;
               document.images[Doc45].src = img_Stars45;
               z = z - 1;
            }   
        }
        while (z>0);        
      }
    }              
         // jetzt mit mehreren 45er spielen
        
}
//  STARS45 in den Handvorrat geben falls 5er Diagonale gewonnen
function vergebenSTARS45() {
 
 // wird nur gespielt wenn Option aktiv (Button geklickt)
   if (!SLevel) {
       return;
   }    
   // STARS45 Cover: im Spiel dem Handvorrat max einmal zuordnen
   
   if (SCover45G) 
      {   
       SCover45G = false;   
       for (var a=1; a<=10; a++)
       {
          if (TCVG[a] == "/")
          {
             TCVG[a] = "45";
             // Positionsgerecht am Ende anfügen         
             document.images[36+a].src = img_Stars45; 
             break;            
          }
       }              
    }
    if (SCover45Y) 
      {   
       SCover45Y = false;   
       SCover45Y_trigger = true;
       // Spielmodus LEVEL: wenn Computer STARS45 Cover dann Counterfeld färben (Info an den Spieler)
       document.getElementById("CCounter").style.backgroundColor = "darkblue";
       for (var a=1; a<=10; a++)
       {
          if (TCVY[a] == "/")
          {
             TCVY[a] = "45";
             // Positionsgerecht am Ende anfügen         
             if (SOffenZu) { 
                document.images[26+a].src = img_Stars45;     
             }   
             break;
          }
       }              
    }
 }

//  STARS45: wenn ausgespielt (und auf der Hand) zufällig COVER aus dem spiel nehmen 
function spielzugSTARS45() {


var z; z=0;
var c; c=0;
var g; // Gesamtzahl der COVER die vom Spielfeld genommen werden

// test alert("45");

// Step 1: Zählen aller Cover auf dem Spielfeld ausser "45"
for (var i=1; i<=5; i++) {
      for (var j=1; j<= 5; j++) {       
           if (TCF_3D[1][i][j] == "C") {
              z = z + 1;
           }   
           if (TCF_3D[1][i][j] == "J") {
              z = z + 1;
           } 
      }
}  
  
  
// Step 2: durch 3 teilen und abrunden
z = Math.floor(z/3);  
      
// Step 3: Zufallszahl ermitteln zwischen 0-3      
c = zufallszahl(4);
c = c + 1; // auf 1-4 korrigieren

// Step 4: Cover aus dem Spiel  nehmen (ca. 5-10)
g = z + c; // Gesamtzahl

  
do  {
   zufallszahl_rc();  // ermitteln einer beliebigen Pos.: Row/Col
   if (TCF_3D[1][Row45][Col45] == "C") {
      TCF_3D[1][Row45][Col45] = "/"
      TCF_3D[2][Row45][Col45] = ""
      TCF_3D[3][Row45][Col45] = ""
      Doc45 = (Row45-1)*5 + Col45 + 1;
      // timer          
      document.images[Doc45].src = img_RockOla3; // auch die Graphik zurücksetzen
      g = g - 1;
      }
   if (TCF_3D[1][Row45][Col45] == "J") {
      TCF_3D[1][Row45][Col45] = "/"
      TCF_3D[2][Row45][Col45] = ""
      TCF_3D[3][Row45][Col45] = ""
      Doc45 = (Row45-1)*5 + Col45 + 1;
      document.images[Doc45].src = img_RockOla3; // auch die Graphik zurücksetzen
      g = g - 1;
      }   
   }  
   while (g > 0);          
}

/* if (window.document.documentMode) {
  
  // Do IE stuff ... falls man das mal braucht
}

//   --- Nur Firefox, Chrome etc. Asynchrone Funktion WAIT nicht direkt aufrufen; 
//       läuft parallel zum weiteren Spiel ab. Wird vom INTERNET EXPLORER nicht unterstützt
async function wait(ms) {
//
   return new Promise(resolve => {
      setTimeout(resolve, ms);
   }
   );
//   
}

//  ---------------------------------------
//  --- ASynchrone Funktion STOPBLINK; ruft WAIT auf
async function stopblink(CPos) {
//
   var CPos; 
   
   await wait(3000);
   clearInterval(t);
   document.getElementById(CPos).style.visibility = "visible";
//   
}

//  ---------------------------------------
*/
</script>
</body></html>
